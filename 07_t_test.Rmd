
# İki Ortalamanın Karşılaştırılması, t-testi
Bölüm \@ref(samplingdist) örnekleme dağılım (sampling distribution) konusunun ana hatlarını tek bir aritmetik ortalama üzerinden ele almıştır. Eğer iki farklı aritmetik ortalama kıyaslanmak isteniyorsa t testi kullanılabilir, bu prosedür aritmetik ortalamaların örnekleme dağılımı üzerine inşaa edilmiştir.

$\bar{Y_1}-\bar{Y_2}$ $(\mu_{\bar{Y_1}-\bar{Y_2}})$ sonucunun örnekleme dağılım ortalaması daima $\mu_1 - \mu_2$ 'dir. Fakat örnekleme dağılım standart sapması $(\sigma_{\bar{Y_1}-\bar{Y_2}})$ araştırmanın tasarısına göre değişir.

_Örnek_ Bir cerrahın yaraların iyileşmesi konusunda araştırma yaptığını düşünelim. Cerrahın kapanan bir yaradan sonra gerilme direncini araştırdığını, yara bandı ve dikiş atma tedavisinin arasında bir fark olup olmadığını araştırdığını varsayalım. Bu çalışmada tek bir faktör vardır, yara kapatma yöntemi ve bu faktöre ait iki alt sınıf vardır, yara bandı ve dikiş. Bu araştırmayı iki farklı şekilde tasarlamak mümkündür. 

**Bağlı gözlemler (within-subjects)** 10 tavşanın her birinin sırtına (omurganın sağına ve soluna) 2 kesik oluşturulur. 2 kesikten bir tanesi yeni geliştirilen bir yara bandı ile diğeri dikiş ile kapatılır, hangi kapatma yönteminin hangi yarayı kapatacağı rassal (random) seçilmelidir. Bu tasarı _bağlı-gözlemler_ olarak isimlendirilmiştir çünkü faktöre ait iki alt sınıf aynı tavşan üzerinde gözlemlenmiştir.

**Bağlı olmayan gözlemler (between-subjects)** 20 tavşan rassal olarak 2 gruba ayrılır, birinci grupta yer alan tavşanların yaraları bant ile, ikinci grupta yer alan tavşanların yaraları ise dikiş ile kapatılır. Yaralar omurganın sağ veya sol tarafında rassal olarak açılmalıdır. Bu tasarı _bağlı olmayan gözlemler_ olarak isimlendirilmiştir çünkü faktöre ait alt sınıflar farklı tavşanlar üzerinde gözlemlenmiştir ve bu tavşanların herhangi bir şekilde eşlenmiş değillerdir. Örneğin aynı anneden gelen iki tavşan rassal olarak gruplara atansa idi gözlemler bağlı olurdu. 


Her iki yara kapatma yönteminden sonra yapılacak gerilme direnci ölçümlerinin evren bazında bir ortalaması ve standart sapması olduğu aşikardır.

Konuyu açıklama amaçlı, yara bandı yönteminden sonra yapılan gerilme direnci ölçümlerine ait ortalamanın ve standart sapmanın bağlı gözlem veya bağlı olmayan gözlem tasarılarında aynı olduğunu düşünelim. 


| Parametres| Bant |              Dikiş             |
|:-------------------:|:------------:|:-----------------------------------:|
|        Ortalama        |     $\mu_B$    |               $\mu_D$               |
|        Standart Sapma |     $\sigma_B$    | $\sigma_D$|
|        Örneklem         |     $n_B$         | $n_D$     |


Buradan itibaren $\mu_B$ yerine $\mu_1$, $\mu_D$ yerine $\mu_2$, $\sigma_B$ yerine $\sigma_1$,$\sigma_D$ yerine $\sigma_2$ kullanılmıştır.


| Örnekleme dağılım parametresi | Bağlı olmayan gözlem |              Bağlı gözlem              |
|:-------------------:|:------------:|:-----------------------------------:|
|        Ortalama ($\mu_{\bar{Y_1}-\bar{Y_2}}$)   |     $\mu_1-\mu_2$    |     $\mu_1-\mu_2$              |
|        Standart sapma ($\sigma_{\bar{Y_1}-\bar{Y_2}}$)   |     $\sqrt{\frac{\sigma_1^2+\sigma_2^2}{n}}$    | $\sqrt{\frac{\sigma_1^2+\sigma_2^2-2\sigma_1 \sigma_2 \rho_{12}}{n}}$ |

1.	$\rho_{12}$  bağlı gözlemlerde, bant ve dikiş sonrası yapılan ölçümlerin arasındakı korelasyondur.

2.	Standart sapmadaki değişiklik  $\rho_{12}$'den kaynaklanır. Eğer bu korelasyon 0 ise iki tasarının da örneklem dağılımına ait standart sapma aynıdır.

Bir araştırma tasarısında hedeflerden biri standart hatayı mümkün olduğunca küçük tutmaktır. Standart hatanın küçük olması elde edilen test istatistiğinin tahmin edilen parametreye yakın olduğu anlamına gelir.

Veri çözümleme sürecinde hata varyansı (error variance) hesaplamak için bir formül seçilir. Yanlış formülün kullanılması büyük bir hatadır.

Uygulamada, standart hatanın hesaplanışı tasarının bağlı mı bağsız mı olduğuna göre değişir. Tasarının yanlış sınıflandırılması, çözümleme sürecinde büyük bir hatadır.


## Bağımsız gruplar t-test (The Independent Groups t-test)
Uşak ilinde yaşayan katılımcıların Toplumsal Cinsiyet Algısı (TCA) puanları yüksek öğretim durumuna göre karşılaştırılmıltır (\@ref(dataWBT)). Her grup için yoğunluk grafikleri;

```{r genattusakcity, collapse=T, eval=T, cache=T, message=F, fig.show='hold', fig.cap='Yüksek Öğretim Durumuna göre TCA puanları '}

# csv yükle
urlfile='https://raw.githubusercontent.com/burakaydin/materyaller/gh-pages/ARPASS/dataWBT.csv'
dataWBT=read.csv(urlfile)

#URL sil
rm(urlfile)
dataWBT_USAK=dataWBT[dataWBT$city=="USAK",]

# factor ve droplevels fonksiyonları bölüm 5.2.4 ile verilmiştir.
# yeni oluşturulan HEF (Higher Education Factor)
# katılımcı lise veya altı diplomaya sahipse 0, non-college
# katılımcı lise üstü diplomaya sahip ise 1,  college
dataWBT_USAK$HEF=droplevels(factor(dataWBT_USAK$higher_ed, 
                    levels = c(0,1), 
                    labels = c("non-college", "college")))

require(ggplot2)
plotdata=na.omit(dataWBT_USAK[,c("gen_att","HEF")])
ggplot(plotdata, aes(x = gen_att)) +
  geom_histogram(aes(y = ..density..),col="black",binwidth = 0.2,alpha=0.7) + 
  geom_density(size=2) +
  theme_bw()+labs(x = "Uşak ilinde Yüksek Öğretim Durumuna göre TCA puanları")+ facet_wrap(~ HEF)+
  theme(axis.text=element_text(size=15),
        axis.title=element_text(size=14,face="bold"))

```


### Bağımsız gruplar t testi için R betiği
Takip edilen basamaklar;

1. Betimsel istatistikler 
2. Test istatistiğinin hesabı

$$t=\frac{\bar{Y_1}-\bar{Y_2}}{S_p \sqrt{\frac{1}{n_1}+\frac{1}{n_2}}}$$


$$ S_p = \sqrt{\frac{(n_1-1)S_1^2 + (n_2-1)S_2^2 }{n_1+n_2-2}}   $$
3. Kritik değerin hesabı $\pm t_{\alpha/2,n_1+n_2-2}$ 
$$H_0:\mu_1-\mu_2=0$$
$$H_1:\mu_1-\mu_2 \neq0$$

```{r, collapse=T, eval=T, cache=F, message=F}

library(psych)
descIDT=with(dataWBT_USAK,describeBy(gen_att, HEF,mat=T,digits = 2))
descIDT
# rapor etmek için
#write.csv(descIDT,file="independent_t_test_desc.csv")
#türkçe excel için
# #write.csv2(descIDT,file="independent_t_test_desc.csv")


# ss
sp=sqrt((85*.543^2 + 50*.608^2)/(86+51-2))

# t-istatistik
tstatistic=(1.832-1.635)/(sp*sqrt(1/86+1/51))

# alfa=0.05 kritik değer
qt(.975,df=135)

```

1.963 kritik değer $t_{.975,135}=1.978$'den küçük olduğu için, $H_0$ kabul edilir. 


$H_1:\mu_1-\mu_2 > 0$ alternatif hipotezi kurulsa idi, kritik değer $t_{.95,135}=1.66$, 1.963'ten küçük olduğu için $H_0$ terkedilirdi.

$H_1:\mu_1-\mu_2 < 0$ alternatif hipotezi kurulsa idi, 1.963 kritik değer olan $t_{.05,135}=-1.66$' ten küçük olmadığı için $H_0$ kabul edilirdi (Burada alternatif hipotez ile örneklem arası farklılık zıt yönde). 

Daha kullanışlı bir R betiği;

```{r, collapse=T, eval=T, cache=F, message=F}

# dataWBT HEF faktörünü içermez, yukarıda HEF faktörü oluşturulmuştur.

t.test(gen_att~HEF,data=dataWBT_USAK,var.equal=T,
                                     alternative="two.sided",
                                     conf.level=0.95)

# büyüktür
t.test(gen_att~HEF,data=dataWBT_USAK,var.equal=T,
                                     alternative="greater",
                                     conf.level=0.95)


# küçüktür
t.test(gen_att~HEF,data=dataWBT_USAK,var.equal=T,
                                     alternative="less",
                                     conf.level=0.95)


```

#### Yönsüz alternatif için rapor örneği
Uşak ilinde yaşayan katılımcılardan yüksek öğretim diplomasına sahip olan 51 kişi için TCA puanları ortalaması 1.64, standart sapması 0.61, puanlara ait dağılım çarpıklık değeri 1.19 ve basıklık değeri 1.09 olarak bulunmuştur. Aynı ilde yüksek öğretim diploması olmayan 86 katılımcının ise TCA puanları ortalaması 1.83, standart sapması 0.54, puanlara ait dağılımın çarpıklığı 0.72 ve basıklığı 0.90 olarak hesaplanmıştır.Bağımsız gruplar t-testi sonuçları, Uşak ilinde yaşayan katılımcıların Toplumsal Cinsiyet Algısı puanlarının yüksek öğretim durumuna göre değişeceği tezini desteklememiştir,  t(135)=1.96, p=0.052. Puanlar arasındaki fark için %95 güven aralığı [-0.002,0.395] olarak hesaplanmıştır.^[ Çözümlemeler R programlama dili kullanılarak tamamlanmıştır, betimsel istatistikler _psych_ paketi[@R-psych], t test istatistiği ise stats paketi [@R-base] ile hesaplanmıştır.]


#### Yönlü alternatif için rapor örneği
Uşak ilinde yaşayan katılımcılardan yüksek öğretim diplomasına sahip olan 51 kişi için TCA puanları ortalaması 1.64, standart sapması 0.61, puanlara ait dağılım çarpıklık değeri 1.19 ve basıklık değeri 1.09 olarak bulunmuştur. Aynı ilde yüksek öğretim diploması olmayan 86 katılımcının ise TCA puanları ortalaması 1.83, standart sapması 0.54, puanlara ait dağılımın çarpıklığı 0.72 ve basıklığı 0.90 olarak hesaplanmıştır. Bağımsız gruplar t testi sonuçları, yüksek öğretim diploması olmayanların TCA puanları yüksek öğretimlere nazaran daha yüksektir tezini desteklemiştir, t(135)=1.96, p=0.026. Puanlar arasındaki fark için %95 güven aralığı [0.030,$\infty$] olarak hesaplanmıştır.


### Bağımsız gruplar t testi varsayımları
Geleneksel t-testi sonuçlarının geçerliği 3 varsayımın ihlal edilmemesi ile mümkündür.

1. Yanıtların bağımsızlığı (independence). Her gruba ait puanların dağılımı birbirinden bağımsız olmalıdır. Yanıtların bağımsızlığını tehdit eden durumlardan biri aynı grup içeresinde yer alan bireylerin birbirlerinin yanıtlarını etkilemesidir (Yantların bağımsızlığı \@ref(moreonindependence) bölümünde daha detaylı ele alınmıştır). 

2. Normallik. Her gruba ait puanlar normal bir dağılımdan çekilmiştir. @myerswell13 grupların örneklem sayısı (n) eşit olduğunda ve toplam örneklemin 40 veya daha fazla olduğu durumlarda t test istatistiğinin normallik varsayımı ihlallerine dirençli olduğunu belirtmiştir. Fakat bu direnç normal dağılımdan büyük çaplı sapmalar (extreme) için geçerli değildir. Bu kitabın yazarları normallik testlerinin bu varsayımı kontrol etmek için kullanılmasına sıcak bakmamaktadır. Görsel bir değerlendirmeden sonra özellikle küçük örneklemlerde, normallik varsayımının ihlal edildiği kaygısı varsa araştırmacılar dirençli tahminleme yöntemlerini kullanmalıdırlar. 

3. Eş varyanslılık. Varyans homojenliği olarak da bilinen bu varsayım, iki grupta yer alan puanların evren bazında eşit varyanslı dağılımlardan çekildiğini kabul eder. @myerswell13 grup örneklem sayılarının **eşit** ve en az 5 olduğu durumlarda varyans eşitliği sağlanamasa dahi 1. tip hata oranlarının önemli ölçüde değişmeyeceğini belirtmiştir. Fakat bu direnç büyük çaplı heterojenlikler için geçerli değildir, örnğin $s_1^2/s_2^2>100$.  @Andy2012 Levene testi gibi eşvaryanslılık testlerinin örneklem sayılarının eşit olmadığı ve küçük örneklemlerde sağlıklı sonuçlar vermediğini belirtmiştir, halbuki bu testlere en çok ihtiyaç durumlar küçük örneklem ve eşit olmayan örneklem sayısı durumlarıdır. Eş varyanslılık testleri ile ilgili bir diğer kaygı, bu test sonucunda varyansların eşit sayılabileceği kararı verilmiş olsa da varyanslar arası farklılığın t test istatistiğini etkileyebileceğidir. _t.test_ fonksiyonu , aksi istenmediği sürece, varyans eşitliği varsayımı yapmaz ve Welch t testini hesaplar.

Varsayımlar hakkındaki bu kısa tanıtımın ele almadığı durumlar vardır. Örneğin hem normalliğin hem eş varyanslılığın ihlal edildiği durumlar tartışılmamıştır. Ayrıca direnç konusu tartışmaya açıktır. Önreğin n1=n2=10 örneklem sayısı ve eş olmayan varyans durumu için 100000 tekrarla yaptığımız bir simülasyon, alfa=.01 ve yönsüz bir t testi için 1. tip hata oranını .018 bulmuştur. Bu oranın kabul edilebilir olup olmadığı tartışmaya açıktır.

Sonuç olarak, eğer yanıtların bağımsızlığı kabul ediliyorsa, örneklem sayısı eşitse ve her grupta en az 20 ise bağımsız gruplar t istatistiğinin büyük ölçüde dirençli olduğu kabulu makul bir kabuldur. Diğer durumlarda varsayım ihlalleri tespit edildi ise araştırmacılar alternatif çözümleme yöntemlerini kullanabilirler.

### Welch t test   

Normalliğin ciddi ölçüde zedelenmediği ve örneklem sayılarının her grup için en az 20 olduğu durumlarda Welch testi geçerli sonuçlar üretir.  Bu test varyans eşdeğerli varsayımı yapmaz.


```{r, collapse=T, eval=T, cache=F, message=F}

t.test(gen_att~HEF,data=dataWBT_USAK,var.equal=F,
                                     alternative="two.sided",
                                     conf.level=0.95)

```

####Welch t testi için raporlama örneği
Uşak ilinde yaşayan katılımcılardan yüksek öğretim diplomasına sahip olan 51 kişi için TCA puanları ortalaması 1.64, standart sapması 0.61, puanlara ait dağılım çarpıklık değeri 1.19 ve basıklık değeri 1.09 olarak bulunmuştur. Aynı ilde yüksek öğretim diploması olmayan 86 katılımcının ise TCA puanları ortalaması 1.83, standart sapması 0.54, puanlara ait dağılımın çarpıklığı 0.72 ve basıklığı 0.90 olarak hesaplanmıştır.Bağımsız gruplar Welch t-testi sonuçları, Uşak ilinde yaşayan katılımcıların Toplumsal Cinsiyet Algısı puanlarının yüksek öğretim durumuna göre değişeceği tezini desteklememiştir,  t(95.89)=1.9, p=0.06. Puanlar arasındaki fark için %95 güven aralığı [-0.082,0.402] olarak hesaplanmıştır.

Eğer normallik varsayımı ciddi ölçüde süpheli ise ve özellikle iki grup farklı şekillerde dağılım gösteriyor ise yüzdeli bootstrap prosedürü (percentile bootstrap) kullanılabilir (@wilcox2012,page 171).

```{r,collapse=T, eval=T, cache=F,message=F}
#bootstrap ile %95 güven aralığı (normallik varsayımı yok)
set.seed(04012017)
B=5000       # bootstrap tekrar sayısı
alpha=0.05   # alfa

# grupları tanımla
GroupCollege=na.omit(dataWBT_USAK[dataWBT_USAK$HEF=="college","gen_att"])
GroupNONcollege=na.omit(dataWBT_USAK[dataWBT_USAK$HEF=="non-college","gen_att"])

output=c()
for (i in 1:B){

  x1=mean(sample(GroupCollege,replace=T,size=length(GroupCollege)))
  x2=mean(sample(GroupNONcollege,replace=T,size=length(GroupNONcollege)))
  output[i]=x2-x1
  }
output=sort(output)

## yönsüz
# D yıldız alt
output[as.integer(B*alpha/2)+1]

# D yıldız üst
output[B-as.integer(B*alpha/2)]

##Yönlü x2>x1
# D yıldız alt
output[as.integer(B*alpha)+1]

#hatalı yön x2<x1
# D yıldız üst
output[as.integer(B*(1-alpha))]

```

####Yüzdeli bootstrap yöntemi için raporlama örneği
Uşak ilinde yaşayan katılımcılardan yüksek öğretim diplomasına sahip olan 51 kişi için TCA puanları ortalaması 1.64, standart sapması 0.61, puanlara ait dağılım çarpıklık değeri 1.19 ve basıklık değeri 1.09 olarak bulunmuştur. Aynı ilde yüksek öğretim diploması olmayan 86 katılımcının ise TCA puanları ortalaması 1.83, standart sapması 0.54, puanlara ait dağılımın çarpıklığı 0.72 ve basıklığı 0.90 olarak hesaplanmıştır.Puanlar arasındaki fark için %95 bootstrap güven aralığı [-0.013,0.390] olarak hesaplanmıştır. Güven aralığı 0 değerini içerdiği için puanlar arasındaki farkın istatistiksel olarak anlamlı olduğu savunulamaz.

**Yönlü test** Alternatif hipotez, yüksek öğretim mezunu olmayan katılımcıların puanlarının yüksek olacağını belirtmiş ise; Puanlar arasındaki fark için %95 bootstrap güven aralığı [0.022,$\infty$] olarak hesaplanmıştır. Eldeki veri yüksek öğretim mezunu olmayanların puanlarının daha yüksek olacığı tezini desteyecek kanıt sunmuştur, $H_0:\mu_{non-college} = \mu_{college}$ in favor of $H_1:\mu_{non-college}-\mu_{college} > 0$.

**Yönlü test** Alternatif hipotez, yüksek öğretim mezunu olmayan katılımcıların puanlarının düşük olacağını belirtmiş ise; Puanlar arasındaki fark için %95 bootstrap güven aralığı [$-\infty$,0.358] olarak hesaplanmıştır. Eldeki veri yüksek öğretim mezunu olmayanların puanlarının daha düşük olacağı tezini desteklememektedir. $H_0:\mu_{non-college} = \mu_{college}$ ve $H_1:\mu_{non-college}-\mu_{college} < 0$.


Yönlü ve yönsüz alternatif testler farklı kriterler kullanır. Yönlü testlerde yönün nasıl belirlendiği savunulmalıdır. Kullanılan örnekte yönsüz alternatif kullanıldığında Welch t testi p değeri 0.06 bulunmuştur. Bu sonuç marjinal anlamlılık olarak yorumlanabilir. Ülkemizde TCA puanları ve yüksek öğretim ilişkisi hakkında alanyazın sınırlı olduğu için yönlü bir alternatif savunulması zordur.    

### Bağımsız gruplar t testi için etki büyüklüğü  {#indepteff}
Bir t testi istatistiği ortalamaların birbirinden farklı olup olmadığı hakkında karar vermeye yardımcı olsa da, bu farklılığın büyüklüğünü yorumlamak için etki büyüklüğü hesaplamaları geliştirilmiştir. Bağımsız gruplar t testi için Cohen etki büyüklüğü , ortalamarın farkını bileşik standart sapmaya (pooled) bölünmesi ile hesaplanır.
$$EB=\frac{t}{\sqrt{\frac{n_1n_2}{n_1+n_2}}}$$

@cohen1962 etki büyüklüğü sınıflaması

| Etki büyüklüğü | Tanım |
|:-----------:|:-----------:|
| .2          | Küçük       |
| .5          | Orta      |
| .8          | Büyük       |





```{r, collapse=T, eval=T, cache=F, message=F}
##  normallik ve eş varyanslılık varsayımı yapıldığında  
## (dirençli yöntem benzer sonuç verdiğiiçin varsayımların kabulü makuldür.)
n1=51
n2=86
tval=1.96

EB=tval/sqrt((n1*n2)/(n1+n2))
EB

#veya effsize paketi ile
t.test(gen_att~HEF,data=dataWBT_USAK,var.equal=F,
                                     alternative="two.sided",
                                     conf.level=0.95)
library(effsize)
cohen.d(gen_att~HEF,data=dataWBT_USAK, paired=F, conf.level=0.95,noncentral=F)
# noncentral=T argümanını araştırabilirsiniz.


```

effsize paketi [@R-effsize] etki büyüklüğünü 0.35 ve ilgili %95 güven aralığını [-0.008, 0.701] olarak hesaplamıştır.

### Extra: Pratikte anlamlılık ve istatistiksel anlamlılık

Bir çalışma sonucunda elde edilen sonuçların istatistiksel olarak anlamlı olmadığı fakat prtaikte anlamlı olduğu öne sürülebilir. Bu sakıncalı bşr durumdur ve sadece küçük örneklemlerde görülür. Küçük bir örneklem ile yapılan çalışmadan sonra pratikte anlamlılıktan bahsetmek tezat oluşturur.

Bir çalısma sonucunda elde edilen sonuçların istatistiksel olarak anlamlı olduğu fakat pratikte anlamlı olmadığı öne sürülebilir. Bu doğru olabilir. 400 kişi ile tamamlanan bir çalışmada istatistiksel anlamlı farklılık .05 etki büyüklüğüne sahip olabilir. Eğer .05 etki büyüklüğü çalışmanın yapıldığı alanda küçük adlediliyorsa istatististiksel anlamlılık pratikte anlamlılığı desteklemez.


### Kayıp veriler ile bağımsız gruplar t testi  

Eklenecek

### Destekleyici grafikler 

Eklenecek

### İstatisksel güç 

İstatistiksel güç konusunun ana hatlarına bölüm \@ref(statisticalpower)'de değinilmiştir. 

```{r, collapse=T, eval=T, cache=F,message=F}
#power.t.test
power.t.test(delta=.35, sd=.6,sig.level=0.05, power=0.95, 
             type="two.sample", alternative="two.sided")

```

Bu örnekte belirlenmiş değerler ortalamalar farkı 0.35, standart sapma 0.6, alfa 0.05, yönsüz test ve hedeflenen güç 0.95 seçildiğinde gereken örneklem sayısı her grup için 78'dir. Diğer bir ifade ile, 156 katılımcı ile belirlenen değerlere (ortalamalar farkı 0.35, standart sapma 0.6, alfa 0.05, yönsüz test) ulaşılması durumunda $H_0:\mu_1-\mu_2=0$ boş hipotezinin terkedilme olasılığı %95'tir.


## Bağlı gruplar t-testi (Within-subjects t-test)

20 tavşan ile gerçekleştirilen deneyde, yara bandı ve dikiş yöntemlerinin yara kapandıktan 10 gün sonra ölçülen germe mukavemeti değerleri üzerinde etkisi araştırılmıştır.

```{r gerMUKexampleplot, collapse=T, eval=T, cache=T, message=F, fig.show='hold', fig.cap='Bağlı gruplar örneği'}
gerMUK=data.frame(tavid=1:20,
                  bant=c(6.59,9.84 ,3.97,5.74,4.47,4.79,6.76,7.61,6.47,5.77,
                         7.36,10.45,4.98,5.85,5.65,5.88,7.77,8.84,7.68,6.89),
                  dikis=c(4.52,5.87,4.60,7.87,3.51,2.77,2.34,5.16,5.77,5.13,
                           5.55,6.99,5.78,7.41,4.51,3.96,3.56,6.22,6.72,5.17))

# Grafik verisi
library(tidyr)
plotdata=gather(gerMUK, metot, mukavemet, bant:dikis, factor_key=TRUE)

require(ggplot2)
ggplot(plotdata, aes(x = mukavemet)) +
  geom_histogram(aes(y = ..density..),col="black",alpha=0.7) + 
  geom_density(size=2) +
  theme_bw()+labs(x = "mukavemet")+ facet_wrap(~ metot)+
  theme(axis.text=element_text(size=15),
        axis.title=element_text(size=14,face="bold"))


```

### Bağlı gruplar için t testi

Takip edilen basamaklar;

1. Betimsel istatistikler 
2. Test istatistiğinin hesabı

$$t=\frac{\bar{Y_1}-\bar{Y_2}}{\sqrt{\frac{S_1^2+S_2^2-2S_1 S_2 r_{12}}{n}}}$$



3.Kritik değerin hesabı $\pm t_{\alpha/2,n-1}$, 
$$H_0:\mu_1-\mu_2=0$$
$$H_1:\mu_1-\mu_2 \neq0$$

```{r, collapse=T, eval=T, cache=F, message=F}

library(psych)
descDT=with(gerMUK,describe(cbind(bant,dikis)))
descDT

corDT=with(gerMUK,cor(bant,dikis,use="complete.obs"))
corDT


# tahmin edilen standart hata (tsh)
tsh=sqrt(((1.71^2+1.49^2)-(2*1.71*1.49*corDT))/(20))

# t-istatistik
tstatistic=(6.67-5.17)/tsh

#  alfa=0.05 kritik değer
qt(.975,df=19)


```

Hesaplanan 3.67, kritik değerden ($t_{.975,19}=2.09$) büyük olduğu için boş hipotez terkedilebilir.

Daha kolay bir R satırı;
```{r, collapse=T, eval=T, cache=F, message=F}

library(psych)
with(gerMUK, t.test(bant,dikis,paired=T,
                                     alternative="two.sided",
                                     conf.level=0.95))

```

#### Raporlama örneği:
Bağlı gruplar t testi hesaplarına dayanarak, gerilim mukavemetinin bant tedavisi (ort=6.67,SS=1.71,çarpıklık=0.55,basıklık=-0.45) ve dikiş tedavisi (ort=5.17,SS=1.49,çarpıklık=-0.08,basıklık=-0.87) arasında farklılık gösterdiği sonucuna varılmıştır, t(19)=3.67, p=0.002 ,r=0.35. Aritmetik ortalamaların farkı için 95% güven aralığı [0.64,2.35] olarak hesaplanmıştır.


###  Varsayımlar: bağlı gruplar için t testi
Puanların farkı ($Y_{1i} - Y_{2i}$) normal bir dağılımdan çekilmiş olmalıdır. Puanların farkları her birey için bağımsız olmalıdır. Bağlı gruplar t testi , örneklem küçük değil ise, normallik varsayımı ihlallerine karşı genellikle dirençlidir.

### Dirençli tahminleme yöntemi: bağlı gruplar için t testi
Eğer dağılım normallikten büyük ölçüde ayrılıyor ise, yüzdeli bootstrap prosedürü kullanılabilir (@wilcox2012,page 201).

```{r,collapse=T, eval=T, cache=F,message=F}
#bootstrap ile %95 güven aralığı (normallik varsayımı yok)
set.seed(04012017)
B=5000       # bootstrap tekrar sayısı
alpha=0.05   # alfa

gerMUK=data.frame(ratid=1:20,
                  bant=c(6.59,9.84 ,3.97,5.74,4.47,4.79,6.76,7.61,6.47,5.77,
                         7.36,10.45,4.98,5.85,5.65,5.88,7.77,8.84,7.68,6.89),
                  dikis=c(4.52,5.87,4.60,7.87,3.51,2.77,2.34,5.16,5.77,5.13,
                           5.55,6.99,5.78,7.41,4.51,3.96,3.56,6.22,6.72,5.17))

output=c()
for (i in 1:B){
  #satırları örnekle
  bs_rows=sample(gerMUK$ratid,replace=T,size=nrow(gerMUK))
  bs_sample=gerMUK[bs_rows,]
  mean1=mean(bs_sample$bant)
  mean2=mean(bs_sample$dikis)
  output[i]=mean1-mean2
  }
output=sort(output)

## yönsüz
# d yıldız alt
output[as.integer(B*alpha/2)+1]

# d yıldız üst
output[B-as.integer(B*alpha/2)]

##Yönlü x2>x1
# d yıldız alt
output[as.integer(B*alpha)+1]

#yanlış yön x2<x1
# d yıldız üst
output[as.integer(B*(1-alpha))]

```

#### Yönsüz yüzdeli bootstrap için örnek rapor:
Yaraların tedavisinden 10 gün sonra gerilim mukavemeti ölçümleri yapılmıştır. Yara bandı ile (ort=6.67,SS=1.71,çarpıklık=0.55,basıklık=-0.45)  dikiş tedavisi (ort=5.17,SS=1.49,çarpıklık=-0.08,basıklık=-0.87) ölçümleri arasındaki fark için 5000 tekrarlı bootstrap prosedürü %95 güven aralığı [0.667,2.2555] olarak hesaplanmıştır. Yeni geliştirilen yara bandı sonrası gerilim mukavemetinin daha yüksek olduğu ve bu farklılığın istatistiksel olarak anlamlı olduğu sonucuna varılmısştır.   


### Effect size for the dependent groups t-test 

En basit etki büyüklüğü hesaplama yöntemlerinden biri; ^[ @lakens2013 Eşitlik 7, fakat bu değer korelasyon 1'e yaklaştıkça sonsuza yaklaşır. @lakens2013  Eşitlik 10 daha uygun bir tercih olabilir.$\frac{mean difference}{(SD_1+SD_2)/2}$]  


$$ES=\frac{t}{\sqrt{n}}$$

```{r, collapse=T, eval=T, cache=F, message=F}
## dirençli prosedürler farklı sonuç vermediği için
## normallik ve varyans eşitliği varsayımları yapılmıştır.
n=20
tval=3.6678

EB=tval/sqrt(n)
EB

library(effsize)
cohen.d(gerMUK$bant,gerMUK$dikis, 
        paired=T, conf.level=0.95,noncentral=F)


```

effsize paketi [@R-effsize] etki büyüklüğünü 0.820 ve ilgili %95 güven aralığını [0.135, 1.505] olarak hesaplamıştır.


### Kayıp veriler ile bağlı gruplar t testi  

Eklenecek

### Destekleyici grafikler 

Eklenecek

### İstatistiksel güç: bağlı gruplar t testi 


```{r, collapse=T, eval=T, cache=F,message=F}
#power.t.test
power.t.test(delta=.35, sd=.6,sig.level=0.05, power=0.95, 
             type="paired", alternative="two.sided")

```

Bu örnekte belirlenmiş değerler ortalamalar farkı 0.35, standart sapma 0.6, alfa 0.05, yönsüz test ve hedeflenen güç 0.95 seçildiğinde gereken örneklem sayısı 41'dir. Diğer bir ifade ile, 41 katılımcı ile belirlenen değerlere (ortalamalar farkı 0.35, standart sapma 0.6, alfa 0.05, yönsüz test) ulaşılması durumunda $H_0:\mu_1-\mu_2=0$ boş hipotezinin terkedilme olasılığı %95'tir.


## Yaygın Tasarılar

Sosyal bilimlerde iki ortalamayı kıyaslamak üzere kurulan tasarılardan yaygın olanları özetlenmiştir.

### Grupların ilişkili olduğu durumlar
Ortalamaların hesaplandığı puanların farklı gruplar altında ilişkili olup olmadğı önemlidir. 

#### Tekrarlanan ölçümler
Aynı katılımcı içiin aynı değişkenin birden fazla ölçülmesi durumu.

1.	__Bireylerin kendi kontrol grubunu oluşturması:__  

Semantik hafızanın aktivasyon hızını ölçmek üzere 100 üniversite öğrencisi ile araştırma yapılmıştır.
Her öğrenci çiftler halinde verilen kelimeleri okumuştur. Okudukları ilk kelime ya bir silah (örneğin mermi, hançer) ya da silah olmayan bir kelimedir. Okudukları ikinci kelime mutlaka agresif bir kelimedir (örneğin yarala, imha et). Her bir öğrenci 192 çift kelimeyi bilgisayarda görüp sesli olarak okumuştur. Bilgisayar ilk kelimeyi 1.25 saniye ekranda tutmuş, .5 saniye siyah ekran göstermiş ve ikinci kelimeyi ekranda göstermiş, her ikinci kelimeden önce reaksiyon zamanını ölçmüştür. Her bireyin reaksiyon zamanı ortalamaları alınmış ve analiz edilmiştir. 

|               |        İlk kelime                    |
|:-------------:|:-----------------:|:----------------:|
|    Öğrenci    |    Silah         |    Silah Değil   |
|    1          |                   |                  |
|    2          |                   |                  |
| ...           |                   |                  |
|    100        |                   |                  |

Her öğrencinin kendi okuma hızı olduğundan, Silah ve Silah olmayan kelimeleri okumak için gereken reaksiyon zamanları birbiri ile ilişkilidir.

2.	__Boylamsal tasarılar:__  6. sınıf öğrencilerinin matematik başarısı dönem başında ve dönem sonunda ölçülmüştür. Amaç puanların değişip değişmediğini görmektir.


|               |        Zaman                 |
|:-------------:|:---------------:|:---------:|
|    Öğrenci    |    Dönem başı    |    Dönem sonu    |
|    1          |                 |           |
|    2          |                 |           |
|  ...          |                 |           |
|    48         |                 |           |


Ölçümler aynı öğrenciler ile tekrarlandığı için puanlar ilişkilidir.

#### Blok tasarıları
Katılımcıların blok olarak ikili eşleştirilmesidir. Her çiftin (blok içindeki) benzer davranması beklenir.

1. __Rassal blok tasarı:__  Okuma hızını artırmak için bir program geliştirilmiştir, etkililiğini araştırmak üzere, 30 ikinci sınıf öğrencisi bir okuma testini cevaplamış, ve puanlarına göre çiftler oluşturmuştur.  


| Çift | Okuma testi puan sırası |
|:----:|:------------------------:|
| 1    | 1,2                      |
| 2    | 3,4                      |
|  ...   |   ...                       |
| 15   | 29,30                    |


Görüldüğü gibi en hızlı okuyan 2 öğrenci ilk çifti, en yavas okuyan iki öğrenci son çifti oluşturmuştur.Çiftlerden her biri rassal olarak yeni program grubuna veya kontrol grubuna atanmıştır.
As shown, the students with the two highest scores were in the first pair, the students with the 

Yeni program son bulduktan sonra öğrencilerin okuma hızları ölçülmüştür

|         |               |          |
|:--------:|:-------------:|:-------:|
| Çift     | Yeni Program | Kontrol |
| 1        |               |         |
| 2        |               |         |
|  ...     |               |         |
| ...      |               |         |
| 15       |               |         |





2. __Rassal olmayan blok tasarı:__  Şiddete maruz kalmış grup çocuğun, şiddet görmemiş  daha kalabalık bir gruptan çocuklar ile genel kaygı düzeyi üzerinden eşleştiğini düşünelim. Sonrasında stres anında gösterdikleri endişe durumlarını ölçelim


|  |        |         |
|:-------------:|:------:|:-------:|
| Çift          | Şiddete maruz kalan | Kontrol |
| 1             |        |         |
| 2             |        |         |
|  ...          |        |         |
| 20            |        |         |


 


3.	__Kalıtsal tasarılar (Familial):__  25 anne ve erişkin kızlarının politik görüşleri alınmıştır.


| Çift |            |
|:----:|:--------------:|:--------:|
|      | Anne         | Kız |
| 1    |                |          |
| 2    |                |          |
|...   |                |          |
| 25   |                |          |




4.	__Dyadik tasaıları:__  Afrikalı-Amerikalı ve Avrupalı-Amerikalı çocuklardan oluşturulan çiftler işbirliği gerektiren küçük oyunlar oyamışlardır. Her bir çocuk eşinin işbirlikçiliğini puanlamıştır.

| Etnisite |                  |                   |
|:-----------------:|:----------------:|:-----------------:|
| Çift              | Afrikalı-Amerikalı | Avrupalı-Amerikalı |
| 1                 |                  |                   |
| 2                 |                  |                   |
| ...               |                  |                   |
| 25                |                  |                   |



### Bağlı olmayan grup tasarılarına örnekler {#designbetween}

1.	__Tamamen rassal tasarı__  
İki farklı manyetik ağrı kesici makinesinin performansı karşılaştırılacaktır. 50 hasta rassal olarak, 25-25, iki makineye alınmış, tedaviden sonra ağrı düzeylerini rapor etmişlerdir. 

| Makine   |          |
|:--------:|:--------:|
| 1 | 2 |
|   .      |          |
|   .      |          |
|   .      |          |



2.	__Rassal olmayan tasarı:__ Sekizinci sınıf öğrencilerinden 50 kız ve 50 erkek seçilmiş 2 basamaklı toplama işlemi yapma hızları ölçülmüştür.

