

# Giriş {#basics}
R veri analizi, grafik veya interaktif web uygulaması gibi basit olmayan çıktılar oluşturabilir. Bu bölümün amacı basit olmayan çıktılar oluşturmadan önce gereken temel prensipleri göstermektir.


## Fonksiyonlar
R gibi programlanabilir gelişmiş hesap makineleri kullanıcıların fonksiyon yazmasına ve saklamasına izin verir. R kullanıcılarının fonksiyonların nasıl çalıştığını kavraması önemlidir.


### R: Basit Hesap makinesi 
R hesap yapabilir. Aşağıdaki işlemleri ve ilgili R kodlarını inceleyiniz. 

\begin{equation}
1+1=2 
(\#eq:bc1)
\end{equation}

```{r, collapse=T}
1+1
```

\begin{equation}
1-1=0 
(\#eq:bc2)
\end{equation}

```{r,collapse=T}
1-1
```

\begin{equation}
1 + (2 / 3) - (2 * 6.5) = -11.33 
(\#eq:bc3)
\end{equation}

```{r, collapse=TRUE}
1 + (2 / 3) - (2 * 6.5)
```

\begin{equation}
sin(30) + 4^3 + log(4) + e^3 + \sqrt{7} = 87.13 
(\#eq:bc4)
\end{equation}

```{r, collapse=TRUE}
sin(30) + 4^3 + log(4) + exp(3) + sqrt(7)
```

Eşitlik \@ref(eq:bc1) 'den \@ref(eq:bc4) 'e kadar olan işlemler R tarafından tamamlanır fakat hafızada tutulmaz. Eğer yaptığınız bir işelmin sonucunu tekrar kullanmak istiyorsanız ona isim vermelisiniz. İsim verdiğiniz R çıktıları oturum süresince (session) tekrar erişime açıktır. Çıktılara oturum kapandıktan sonra da ulaşmak istiyorsanız kaydetmelisiniz. Kaydetme işlemleri ilerleyen bölümlerde ele alınmıştır. İsim verme işlemi fraklı şekillerde yapılabilir;   "=", "<-" or "<<-". Bu materyal "=" operatörünü kullanır.

Eşitlik \@ref(eq:bc1) 'den \@ref(eq:bc4) 'e kadar olan işlemleri oturum süresince saklamak için;

```{r, collapse=TRUE}
a=1 - 1
b=1 + 1
c=1 + (2 / 3) - (2 * 6.5)
d=sin(30) + 4^3 + log(4) + exp(3) + sqrt(7)
```

İsim verdiğiniz çıktılar ile işlem yapabilirsiniz.
```{r, collapse=TRUE}
a+b+c+d
```

İsim verdiğiniz bir çıktıyı değiştirebilirsiniz (overwrite)
```{r, collapse=TRUE}
e=3+2
e
e=e+10
e
```

Farklı bir isim vermek için (Not: R büyük harf küçük harf ayrımı yapar)
```{r, collapse=TRUE}
Equation1_output=a
Equation1_output + b + c + d  # a+b+c+d ile eşit
```


###R: Programlanabilir Hesap makinesi 
En basit hali ile fonksiyon 3 parçadan oluşur, girdi, işlem, çıktı. Bu bölümde verilen fonksiyonların test puanlarının analiz basamağında kullanıldığını varsayalım.


#### Tek girdi - Tek Çıktı  
Aşağıda verilen fonksiyonun adı _sabit5_ olsun. _sabit5_ fonksiyonu her öğrencinin puanına 5 puan ekleyecektir. Bir diğer deyişle, son derece basit bir fonksiyon olan _sabit5_ verilen bir puana 5 ekleyerek çıktı oluşturur.

```{r,collapse=T}
sabit5=function(girdi){
    cikti=girdi+5
    return(cikti)
    }

sabit5(girdi=50)
sabit5(60)
sabit5(80)
```

_sabit5_ fonksiyonu girdiyi alır , 5 ekler _(input+5)_, ve bir çıktı oluşturur _(cikti=girdi+5)_, ve çıktıyı rapor eder _(return(cikti))_.  Bütün bu işlemler _{   }_ içinde verilmelidir. 

Diğer basit bir fonksiyon _sistematik1_ olarak isimlendirilmiştir ve verilen her bir puana %1 ekler.

```{r,collapse=T}
systematic1=function(input){
    output=input+(input/100)
    return(output)
    }

systematic1(input=50)
systematic1(100)
systematic1(120)
```


#### Çoklu Girdi-Tek Çıktı 
Daha önce verilen fonksiyonlar tek girdi alıp tek çıktı oluşturmuştur. Bu örnekte iki farklı girdi ve tek bir çıktı vardır. Fonksiyona _eksipuan_ adı verilmiştir. Ham puan ve yanlış sayısı verilen fonksiyon, her yanlış için 0.2 puan düşürür. Örneğin 90 puan ve 6 yanlış girildiğinde çıktı olarak (90-0.2*6) 88.8 verilir. 

```{r, collapse=TRUE}
eksipuan=function(puan, yanlis){
    cikti=puan - (0.2 * yanlis)
    return(cikti)
    }
eksipuan(puan=90,yanlis=6)
eksipuan(90,17)
```

Bir R fonksiyonunda girdiler _argüman_ (arguments) olarak isimlendirilir. _eksipuan_ fonksiyonu 2 argümana sahiptir (puan ve yanlış) ve tek bir çıktı verir. Çoklu argüman ve çoklu çıktı içeren fonksiyonlar yazılabilir. 

####  Çoklu Girdi ve Çoklu Çıktı

_geridönüt_ fonksiyonu doğru yanıt sayısını ve her sorunun kaç puan olduğu argümanlarını alır, çıktı olarak toplam puanı ve 100 almak için eksik kalan soru sayısını hesaplar.

```{r, collapse=TRUE}
geridonut=function(dogruyanit, katsayi){
    total=dogruyanit*katsayi
    kalan=(100-total)/katsayi
    cikti=c(paste("Puan:", total," eksik:",kalan))
    return(cikti)
    }
geridonut(dogruyanit=20,katsayi=2)
geridonut(27,2)
```

#### Basit Hata
R fonksiyonlarının çalışması için argumanların doğru kullanılması gerekir. Eğer _geridönüt_ fonksiyonuna _katsayı_ parametresini girmezseniz bir hata ile karşılaşırsınız.

```{r, collapse=TRUE,error=T}
geridonut=function(dogruyanit, katsayi){
    total=dogruyanit*katsayi
    kalan=(100-total)/katsayi
    cikti=c(paste("Puan:", total," eksik:",kalan))
    return(cikti)
    }
geridonut(dogruyanit=20)
```

#### Basit uyarı
R fonksiyonları uyarı içerebilir. Daha önce yazdığımız _eksipuan_ fonksiyonunu düşünelim

```{r, collapse=TRUE,error=T}
eksipuan=function(puan, yanlis){
    cikti=puan - (0.2 * yanlis)
    return(cikti)
    }
eksipuan(puan=50,yanlis=10)

```

Bu fonksiyona bir uyarı ekleyebiliriz. Örneğin hesaplanacak puan sıfırın altında ise bir uyarı verebbiliriz.

```{r, collapse=TRUE}
eksipuan2=function(puan, yanlis){
      cikti=puan - (0.2 * yanlis)
      if (cikti<0) 
    warning("Yeni puan 0'dan düşük")  
    return(cikti)
    }
eksipuan2(puan=10,yanlis=60)
```


#### Basit Sekte
Bir R fonksiyonu, yazarın belirlediği durumlarda sekteye uğrayabilir. Örneğin _eksipuan3_ fonksiyonunu 20'den düşük puanlar için düzeltme yapmayacak şekilde yazabiliriz.
 
```{r, collapse=TRUE,error=T}
eksipuan3=function(puan, yanlis){
 
    if ((puan)<(20)) 
    stop("20den düşük puanlar için bu fonksiyon işlemez")
  
     cikti=puan - (0.2 * yanlis)
      return(cikti)
    }
eksipuan3(10,9)

```


### Yardım!
Her R kullanıcısı yeni fonksiyonlar yazmak zorunda değildir, fakat fonksiyonların nasıl çalıştığını bilmek önemlidir. Eğer R bir hata veriyorsa bu genellikle kullanıcı veya datadan kaynaklıdır. Her ne kadar çok karşılaşılmasa da hatanın fonksiyonun kendisinden kaynaklandığı durumlar da olabilir. 

R fonksiyonlar sayesinde çalışır. Dünyanın her yerinden araştırmacılar R fonksiyonları yazmakta, bu fonksiyonları bir R paketi olarak erişime açmaktadırlar. Hali hazırda 10 binden fazla R paketi vardır. R programını indirdiğinizde yaklaşık 30 R paketi bilgisayarınıza otomatik olarak indirilir. Bu 30 R paketinde binlerce fonksiyon bulunur.

R programınızı yüklediğinizde otomatik olarak yüklenen 30 paketten bir tanesi _base_ dir. Bu paketin içinde 1200'den fazla fonksiyon bulunur. Örneğin _mean_ fonksiyonu aritmetik ortalama hesaplar.Genellikle paketler detaylı açıklamalar ile birlikte sunulur. Kullanıcıların bu açıklamalara ulaşabilmesi için çeşitli yollar mevcuttur; _help_, _?_, _??_ veya _example_



```{r, collapse=T, eval=F}
help("base")  # 
help(mean)    # aritmetik ortalama fonksiyonu ve argümanları
?mean         # aritmetik ortalama fonksiyonu ve argümanları
??mean        # aritmetik ortalama fonksiyonu ve argümanları
example(mean) # aritmetik ortalama fonksiyonu ve argümanları

```


## R Data Tipleri
Bu bölümde vektörler, matrisler, değişken çeşitleri, kayıp veriler ve data çerçeveleri (data frames) kısaca tanıtılmıştır.


### Vektörler
R _c_ fonksionu ile vektör oluşturabilir. 10 öğrenci için not girelim.

```{r, collapse=T}
notlar=c(40,50,53,65,72,77,79,81,86,90)
notlar
```

R vektörler üzerinden işlem yapabilir.

```{r, collapse=T}
notlar=c(40,50,53,65,72,77,79,81,86,90)
#her nota 10 ekle
notlar+10
#her nota yüzde 10 ekle
notlar+(notlar*0.10)
#kendi ile çarp
notlar*notlar
# yeni notlar
notlar2=c(30,40,46,58,64,66,69,72,74,81)
# notlar ve notlar2 nin ortalamasını al
(notlar+notlar2)/2

# ilk notların yüzde 40ı ile ikinci notların yüzde 60ını topla
notlar*0.4 + notlar2*0.6


```

Vektör oluşturmak için işeyarar birçok fonksiyon vardır. Örneğin _rep_ fonksiyonu (bknz: example(rep)) aynı değerleri tekrarlamak için kullanışlıdır.

_rnorm_ fonksiyonu normal dağılıma sahip veriler simüle etmek için işe yarar. Eğer _?rnorm_ kullanılırsa bu fonksiyonun 3 argümanı olduğu görülür  _rnorm(n, mean = 0, sd = 1)_. Bu fonksiyon vektör uzunluğu (değişken sayısı) _n_ verilmediği sürece çalışmaz. Eğer sadece _n_ verilirse, popülasyon ortalaması 0 ve standart sapması 1 olan dağılımdan rasgele seçilen değerler ile bir vektör oluşturulur. Bu parametreler değiştirilebilir. Örneğin _rnorm(12,mean=10,sd=2)_  popülasyon parametreleri 10 ve 2 olan normal bir dağılımdan 12 adet gözlem çeker. Benzer bir fonksiyon _runif(n, min = 0, max = 1)_ tekdüzey bir dağılımdan gözlem çeker.


```{r, collapse=T}
a=1:12            # a 1 den 12ye tam sayılar
rep(0,12)         # 0 12 kez tekrarlanır
rep(1:5,each=3)   # 1 den 5'e tam sayılar 3er kez tekrarlanır
rep(1:5,times=3)  # 3 kere 1'den 5'e tekrarla
seq(from=1,to=12) # 1'den 12'ye tam sayılar
seq(1,25,by=2)    # 1'den 25'e ikişer atla
seq(1,6,by=0.5)   # 1'den 6'ya 0.5 atla
rnorm(12)        #  ~N(0,1) 12 gözlem
rnorm(12,mean=10,sd=2) #~ N(10,2) 12 gözlem
runif(12, min = 10, max = 37) 
```



### Matrisler
R matrisler oluşturup işlem yapabilir.

```{r, collapse=T}
A=matrix(1:16,ncol=4,nrow=4) #4x4 matris oluştur
A
B=matrix(runif(16,min=20,max=40),ncol=4) #4x4 matris oluştur

# işlem örnekleri
A+B    # topla
A*B    # çarp
A%*%B  # matris çarp
t(B)   # çevir
```

### Değişkenler {#variables}
Çözümlenecek verisetinin özelliklerini bilmek çok önemlidir. R içerisinde çözümlenecek değişkenler genellikle sınıflama, sıralı, sürekli , kayıp veya tarih tipindedir.


#### Sınıflama
R'da bir sınıflama verisi alfanumerik şekilde girilebilir fakat yorumlanması sayısal değil sınıflama şeklindedir. Örneğin;


```{r, collapse=T,cache=T}
adres=c("AAX","BBZ","CBT","DBA","DDC","XZT")
cinsiyet=c("M","F","F","M","F","M")
id=sample(letters,6)
program=rep(c("var","yok"),each=3)
sehir=as.character(1:6)
```

#### Sıralı
Sıralı bir değişken sınıflama değişkenine göre daha çok bilgi içerir. Sıra ifade eder fakat  değerler arasındaki farklılık anlmalı değildir. Örneğin koşucular birinci, ikinci ve üçüncü olarak sıralanabilir fakat bu sıralama verisi birinci ile ikinci arasında kaç dakika farklılık olduğunu belirtmez. Birinci koşucu ikinciden 5 saniye hızlı iken, ikinci koşucu üçüncü koşucudan yarım saat daha hızlı olabilir.
R içerisinde _ordered_ fonksiyonu ve _level_ argümanı ile sıra belirtilebilir. Eğer _level_ argüanı boş bırakılırsa R değerleri küçükten büyüğe sıralar.


```{r, collapse=T,cache=T}
soru1=ordered(c("zayif","orta","iyi","iyi","zayif","zayif"),
              levels=c("zayif","orta","iyi"))
ses=ordered(c(1,3,2,2,1,3),levels=c("1","2","3"))
```

#### Sürekli
Eşit aralıklı veya eşit oranlı değişkenler sıralı ve sınıflama değişkenlerine göre daha fazla bilgi içerir. Değerler arasındaki farklılık anlamlıdır. 

```{r, collapse=T,cache=T}
notlar=c(52,75,39,62,24,86)
notlar=rnorm(n=6,mean=160,sd=5)
```


#### Tarih 
_as.Date_ fonksiyonu ile tarih verisi girilebilir. 


```{r, collapse=T,cache=T}
dt=as.Date(c("1994-06-01","1988-10-20","1990-12-01",
                   "1978-03-23","1974-08-22","1994-11-04"))

dt

tatil=as.Date(c("01/01/2016","04/23/2016","05/19/2016","08/30/2016","09/29/2016"),
                 format="%m/%d/%y")

tatil

Sys.Date( )
Sys.Date( )-dt
```

#### Doğru-Yanlış (logical)
Bu değişken TRUE veya FALSE değerlerini alır. Eğer sayısal veri olmaya zorlanırsa 1 ve 0 değerlerini alır. Aşağıda verilen kod girilen notların ortalamadan düşük olup olmadığını gösterir.

```{r, collapse=T,cache=T}
notlar=c(52,75,39,62,24,86)    # notlar
notlar>mean(notlar)            
as.numeric(notlar>mean(notlar)) # 1 ve 0.
```

### Faktörler
R içerisinde yer alan _factor_ veri tipi sıralı ve sınıflama verileri için kullanılan bir çatıdır.

```{r, collapse=T,cache=T}
kurs=factor(c("muhasebe","garson","temizlik","garson","muhasebe","garson"))
ga1=factor(c(1,1,3,4,2,3),levels = 1:4,
           labels=c("tamamenkatilmiyorum","katilmiyorum","katiliyorum","tamamenkatiliyorum"))
ga2=factor(c(1,3,4,4,2,3),ordered = T)
ga3=gl(n=3,k=2,labels=c("A","B","C"),ordered=F)

```

Faktörler önemlidir. Faktörlerin alt sınıfları (levels) dikkatli bir şekilde incelenmelidir. Çözümleme aşamasında kullanılmayan alt sınıflar silinmelidir.
Örneğin veri seti bölünmeden önce _Renk_ faktörü girilmiş olsun, "mavi", "yeşil", "sarı" alt sınıflar olsun. Daha sonra veri seti bölündüğünde alt sınıf "sarı" kullanılmamış olsun. R _Renk_ değişkenini hala 3 alt sınıflı olarak düşünecektir ve ona göre işlem yapacaktır. Bu hatalara sebep olur. Droplevel fonksiyonu kullanılarak faktör değişkeni düzeltilmelidir.
```{r, collapse=T,cache=T}

renk=factor(c(1,1,1,2,2,3),levels = 1:3,labels=c("mavi","yesil","sari"))
renk
renk2=renk[1:5]  # renk2 değişkeni son degeri almadı
renk2  #fakat hala 3 level mevcut
droplevels(renk2) #kullanılmayan level silindi
```


### Kayıp Veriler
Veri seti kayıp veriler içerebilir. R kayıp verileri _NA_ (not available) ile belirtir. 
```{r, collapse=T,cache=T}
gelir=c("maas","maas","destek",NA,NA,"maas")
hanekisi=c(3,2,3,NA,NA,4)
```

NOT: Kayıp veri belirleyiciler çetrefilli olabilir. NA, <NA> , " " (boşluk) veya önceden belirlenmiş bir sayı,örneğin -99 kayıp verileri temsil edebilir.

```{r, collapse=T,cache=T}
ornek = factor(c('maas','destek', NA, 'NA'," ",-99,"-99"))

# faktör içerisinde kayıp veriler <NA> olarak verilir.
#  < > içinde yer almayan NA faktör sınıfını gosterir.
# " " bu da faktör alt sınıfını gösterir
#-99 and "-99" aynı faktör sınıfını gösterir


# is.na fonksiyonu kayıp verileri gösterir.
# ornek için bakıldığında sadece 3. eleman kayıp veri olarak görünür
is.na(ornek) 


#çözüm 'NA', " ", -99 ve "-99" ları NA'ye çevirelim
ornek[ornek=='NA' | ornek==" "| ornek== -99 | ornek== "-99"]=NA

#kontrol
is.na(ornek)

#droplevel kullanalım
ornek=droplevels(ornek)

```

### Veri Çerçeveleri (Data Frames) {#dataframes}
Bir veri çerçevesi değişkenlerden oluşur. Sosyal bilimcilerin genellikle değişkenler arası ilişkileri araştırdığını düşünürsek, veri çerçeveleri kullanıcılarının temel R ögesidir. Daha önce oluşturduğumuz değişkenleri bir veri çerçevesine alabiliriz;


```{r, collapse=T,cache=T}
# hatırlatma
# id=sample(letters,6)

# program=rep(c("var","yok"),each=3)

# cinsiyet=c("M","F","F","M","F","M")

# soru1=ordered(c("zayif","orta","iyi","iyi","zayif","zayif"),
#              levels=c("zayif","orta","iyi"))

# ses=ordered(c(1,3,2,2,1,3),levels=c("1","2","3"))

# notlar=c(52,75,39,62,24,86)

# gelir=c("maas","maas","destek",NA,NA,"maas")


# dt=as.Date(c("1994-06-01","1988-10-20","1990-12-01",
#                    "1978-03-23","1974-08-22","1994-11-04"))

# kurs=factor(c("muhasebe","garson","temizlik","garson","muhasebe","garson"))

basit_data=data.frame(id,program,cinsiyet,soru1,ses,
                      notlar,gelir,dt,kurs)
basit_data

```

Veri setleri el yordamı ile girildiğinde veya hazır olarak R a aktarıldığında (örneğin excel dosyasından) veri setinin yapısını incelemek önemlidir. _str_ (structure) fonksiyonu kullanılabilir.

```{r, collapse=T,cache=T}
str(basit_data)
```

## R Paketleri
R bilgisayarınıza kurulurken 30'dan fazla paket yükler. Bu paketler _sistem kütüphanesinde_ saklanır. R paketleri otomatik olarak yüklenen bu 30 paketle sınırlı değildir, örneğin doğrusal karma etkiler modellerini (linear mixed models) çözümlemek için _lme_[@lme4pack] paketi kullanılabilir. Bu paket 60000'den fazla bilgisayara yüklenmiş ve 1500'den fazla akademik yayında kullanılmıştır. R paketleri genellikle CRAN (comprehensive R archive network) içerisinde bulunur. Paketler yazarlar tarafından güncellendiği sürece CRAN'da bulunur. R paketlerini CRAN'dan çekerek kendi bilgisayarınızda saklayabilirsiniz. Yüklediğiniz paketler _kullanıcı kütüphanesinde_ tutulur. Paketleri bir R oturumunda kullanabilmek için onları aktif hale getirmeniz gerekir.

R ve R Studio'yu kurma aşamasında R-RStudio-R paketleri arasında bilgisayar tarafından sağlanan otomatik bir bağ olduğunu farketmiş olabilirsiniz. R studio R'dan sonra yüklendiğinde bilgisayarınızı tarayacak, R programının yerini bulacak ve ona bağlanacaktır. Hem R hem de R Studio R paketlerinizin yerini bulabilir (eğer siz yerlerini değiştirmediyseniz). Eğer R paketlerinizin nerede olduğunu öğrenmek isterseniz _.libPaths()_ fonksiyonunu kullanabilirsiniz.

CRAN'da yer alan R kütüphaneleri bilgisayarınıza kolayca yüklenebilir. R studio'da yer alan _Packages_ ve _install_ sekmesinden veya  _install.packages("paketismi")_ fonksiyonu ile paketleri indirebilirsiniz. Paketlerin oturum esnasında aktif hale getirilmesi gerekir. Bu işlem R studio _Paketler_ sekmesinde yer alan paket isimlerinin yanındaki kutucuğa tıklayarak veya _library("paketismi")_ fonksiyonu ile tamamlanabilir. Bu basamaklar Video 4 ile gösterilmiştir.\@ref(fig:Video4).

```{r Video4, fig.cap=' R Paketi Yükle', fig.width=8, fig.height=6 , echo=FALSE}
knitr::include_url("https://www.youtube.com/embed/BiJhU0Rn6t4")
``` 


## Çalışma alanı (workspace) {#theworkspace}
Bir R oturumu açtığınızda ve R işlemleri yaptığınızda bu işlemler çalışma alanında yürütülür. Her adımınız R Studio sağ üst köşede yer alan _History_ sekmesinde görülür. Çalışma alanınızı oturum sonunda kaydedebilirsiniz. Oturum esnasında oluşturduğunuz R çıktıları çalışma alanında tutulur. _ls()_ fonksiyonu ile bu çıktıları görebilirsiniz.  

R çıktıları çalışma alanına getirilebilir veya çalışma alanı dışına uzun süreliğine kaydedilebilir. Dosyaların yerlerini bulmak ile uğraşmak istemiyorsanız bütün işlemlerinizi aynı klasörde tamamlamayı tercih edebilirsiniz. _getwd()_ fonksiyonu size hangi klasör içinde (working directory) olduğunuzu gösterir. Uzun süreliğine kaydetmek istediğiniz bir R çıktısı bu klasöre kolayca kaydedilebilir. Aktif olan klasörünüzü _setwd()_  fonksiyonu ile değiştirebilirsiniz. Tabiki bilgisayarınızda her hangi bir klasörde, hatta internette sakladığınız bir nesneyi R çalışma alanınıza getirebilir veya çalışma alanınızda oluşturduğunuz bir dosyayı bilgisayarınızda her hangi bir klasöre kaydedebilirsiniz. Fakat bu durumlarda adresi (location) hatasız bir şekilde R'a bildirmeniz gerekir. Girdi ve Çıktı konuları bir sonraki bölümde ele alınmıştır. 


