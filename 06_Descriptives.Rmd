

# Betimleyici İstatistikler ve Hipotez Testi
Betimleyici istatistikler örneklemi tanımlamayı amaçlar. Bu bölüm içeriside daha önce tanıtılan dataWBT (\@ref(dataWBT)) kullanılarak (a) betimleyici istatistikler hesaplanmış (b) basit grafikler çizilmiş ve (c) hipotez testi açıklanmıştır.  

Bu bölümde yer alan R kodlarını kullanmak isteyen araştırmacıların bir önceki bölümü inceledikleri varsayılmıştır. Bu bölümde yer alan basamakların atlanmadan takip edildiği varsayımı da yapılmıltır. dataWBT çalışma alanınıza çağırmak için;


```{r, collapse=T, eval=T, cache=T, message=F}

# CSV yükle
urldosya='https://raw.githubusercontent.com/burakaydin/materyaller/gh-pages/ARPASS/dataWBT.csv'
dataWBT=read.csv(urldosya)

#remove URL 
rm(urldosya)
```

##Betimleyici İstatistikler  {#descstats}
Bu alt bölümde ortalama, ortanca, varyans, standart sapma, çarpıklık ve basıklık hesaplanmıştır. Örneklerde toplumsal cinsiyet algısı (gen_att) değişkeni kullanılmıştır.


### Ortalama
Eşitlik \@ref(eq:mean) 'de verildiği gibi, ortalama, bir değişkeni oluşturan değerlerin toplamının toplam değer sayısına bölünmesi ile hesaplanır.  

\begin{equation}
\bar{Y} = \frac{1}{n} \sum\limits_{i=1}^n {Y_i}
(\#eq:mean)
\end{equation}

```{r, collapse=T}
# gen_att değişkeninin ortalamasını hesapla
mean(dataWBT$gen_att,na.rm = T)

# birden fazla değişkenin ortalamasını hesapla
# ?colMeans
colMeans(dataWBT[,c("gen_att","item1")],na.rm = T)

```


### Ortanca
Büyükten küçüğe veya küçükten büyüğe dizilmiş bir değişkenin orta noktasına ortanca denir. Eğer değişkenin eleman sayısı (n) tek sayı ise  $({(n+1)/2}).$ sırada yer alan, eğer çift sayı ise  $(n/2).$ ve $((n+1)/2).$ değerin ortalaması ortancayı verir.
```{r, collapse=T}
# Ortanca hesapla
median(dataWBT$gen_att,na.rm = T)
```

### Varyans

Varyans değişkenin ne kadar yayıldığını anlamada çok kullanılan bir ölçüdür. Eşitlik \@ref(eq:variance) ile hesaplanır.

\begin{equation}
s_Y^2  = \frac{1}{{n - 1}}\sum\limits_{i = 1}^n {\left( {Y_i  - \bar Y} \right)^2 }
(\#eq:variance)
\end{equation}


```{r, collapse=T}
#varyans hesapla
var(dataWBT$gen_att,na.rm = T)
```

### Standart Sapma
Varyansın kareköküdür ve Eşitlik \@ref(eq:std) ile hesaplanır.

\begin{equation}
s_Y  = \sqrt {\frac{1}{{n - 1}}\sum\limits_{i = 1}^n {\left( {Y_i  - \bar Y} \right)^2 } }
(\#eq:std)
\end{equation}

```{r, collapse=T, eval=T, cache=T,message=F}
#SS hesapla
sd(dataWBT$gen_att,na.rm = T)

```

### Çarpıklık (Skewness)
Çarpıklık değeri dağılımın şekli hakkında bilgi verir. Tamamen simetrik olan bir dağılımın çarpıklık değeri 0'dır.

Dağılımın sol kuyruğu sağ kuyruğuna nazaran uzun olduğunda çarpıklık değerinin sıfırdan küçük hesaplanması olasıdır. Bu tür dağılımlar sola çarpık veya negatif çarpık olarak isimlendirilir. Bu tür dağılımlarda medyan ortalamadan yüksektir

Dağılımın sağ kuyruğu sol kuyruğuna nazaran uzun olduğunda çarpıklık değerinin sıfırdan büyük hesaplanması olasıdır. Bu tür dağılımlar sağa çarpık veya pozitif çarpık olarak isimlendirilir. Bu tür dağılımlarda medyan ortalamadan küçüktür.

Örneklem için çarpıklık formülü ^[Bu formül popülasyon için yanlı (biased) bir tahminleyicidir. R yanlı olmayan çarpıklık ve basıklık istatistikleri hesaplayabilir, _describe_ fonksiyonu  _type_ argümanı incelenebilir. ]


\begin{equation}
\sqrt{n}\frac{\sum_{i}^{n}\left ( X_{i}-\bar{X} \right )^{3}}
{\left (\sum_{i}^{n} \left ( X_{i}-\bar{X} \right )^{2} \right )^{3/2}}
(\#eq:skew)
\end{equation}

Örneklem için çarpıklık değeri _moments_ [@moments] paketinde yer alan _skewness_ fonksiyonu ile hesaplanabilir. 


```{r, collapse=T, eval=T, cache=T,message=F}
#çarpıklık hesapla
library(moments)
skewness(dataWBT$gen_att,na.rm = T)

```


```{r, eval=F, options(width=6)}
NOT: Çarpıklık ve basıklık değerleri için standart hata ve sonrasında z-puanı hesaplanabilir.
Hesaplanan bu z-puanı seçilen bir kritik değer ile (ör. 1.96) kıyaslanarak
çarpıklık veya basıklığın istatistiksel olarak anlamlı olup olmadığı sınanabilir.
Benzer şekilde normallik testleri de (ör. Shapiro-Wilk) yapılabilir. Fakat bu testler
örneklem büyüklüğüne hassasstır. Bir diğer deyişle örneklem büyüdükçe çok küçük farklılıklar
istatistiksel olarak anlamlı bulunabilir.
Çarpıklık,basıklık veya normallik testlerinin varsayım ihlallerini tespit etmek 
üzere kullanılışı nispeten eskimiş yöntemlerdir. Bu testleri kullanmak yerine normallik
grafik üzerinden incelenip, dirençli tahminleyicilerin (robust estimators) veya
Monte Carlo simulasyon tekniklerinin çıktıları incelenebilir.
```

#### Çarpıklık örnekleri
Normal bir dağılım ve çarpıklık istatistiği;

```{r, fig.height=5, fig.cap="Normal dağılım gösteren bir sürekli değişken",echo=F}
library(moments)
set.seed(12345)
noskew=rnorm(10000)
skval=round(skewness(noskew),3)
hist(noskew, col = "blue", breaks = 75,main="Normal dağılım gösteren bir sürekli değişken",
     xlab=paste("çarpıklık=",skval,sep=""))
rug(noskew)
```

Sola çarpık sürekli değişken;

```{r, fig.height=5, fig.cap="Sola çarpık sürekli değişken",echo=F}
set.seed(12345)
noskew=rbeta(10000, shape1=22, shape2=2, ncp = 0)
skval=round(skewness(noskew),3)
hist(noskew, col = "blue", breaks = 75,main="Sola çarpık sürekli değişken",
     xlab=paste("çarpıklık=",skval,sep=""))
rug(noskew)
```

Sağa çarpık sürekli değişken;

```{r, fig.height=5, fig.cap="Sağa çarpık sürekli değişken",echo=F}
set.seed(12345)
noskew=rbeta(10000, shape1=1.5, shape2=12, ncp = 0)
skval=round(skewness(noskew),3)
hist(noskew, col = "blue", breaks = 75,main="Sağa çarpık sürekli değişken",
     xlab=paste("çarpıklık=",skval,sep=""))
rug(noskew)
```

### Basıklık (Kurtosis)

Basıklık değeri dağılımın şekli hakkında bilgi verir. Normal bir dağılımın Pearson basıklık değeri 3'tür.
Eşitlik \@ref(eq:kurto) basıklık değerinin hesaplanışını gösterir.

\begin{equation}
n\frac{\sum_{i}^{n}(X_i-\bar{X})^4}{(\sum_{i}^{n}(X_i-\bar{X})^2)^2}
(\#eq:kurto)
\end{equation}

Eşitlik \@ref(eq:kurto) sıfırdan küçük değerler vermez. 0 ile 3 arasında yer alan değerler genellikle düz dağılımlarda hesaplanır, örneğin tekdüzey dağılımlar. Uzun kuyruklu dağılımlarda 3'ten büyük değerler görülebilir. Alanyazında yorumu kolaylaştırmak için Eşitlik \@ref(eq:kurto) 'ten 3 çıkarıldığı durumlar mevcuttur.

Örneklem için Pearson basıklık değeri _moments_ [@moments] paketinde yer alan _kurtosis_ fonksiyonu ile hesaplanabilir.


```{r, collapse=T, eval=T, cache=T,message=F}
#basıklık hesapla
library(moments)
kurtosis(dataWBT$gen_att,na.rm = T)

```

#### Basıklık Örnekleri
Normal bir dağılım ve basıklık ölçüsü

```{r, fig.height=5, fig.cap="Normal dağılım gösteren bir sürekli değişken",echo=F}
set.seed(12345)
noskew=rnorm(10000)
skval=round(kurtosis(noskew),3)
hist(noskew, col = "blue", breaks = 75,main="Normal dağılım gösteren bir sürekli değişken",
     xlab=paste("basıklık=",skval,sep=""))
rug(noskew)
```

Tekdüzey bir dağılım ve basıklık değeri

```{r, fig.height=5, fig.cap="Tekdüzey dağılım gösteren sürekli değişken",echo=F}
set.seed(12345)
noskew=runif(10000, 0, 2)
skval=round(kurtosis(noskew),3)
hist(noskew, col = "blue", breaks = 75,main="Tekdüzey dağılım gösteren sürekli değişken",
     xlab=paste("basıklık=",skval,sep=""))
rug(noskew)
```

Beta dağılımı gösteren bir sürekli değişken

```{r, fig.height=5, fig.cap="Beta dağılımı gösteren bir sürekli değişken",echo=F}
set.seed(12345)
noskew=rbeta(10000, shape1=1.5, shape2=12, ncp = 0)
skval=round(kurtosis(noskew),3)
hist(noskew, col = "blue", breaks = 75,main="Beta dağılımı gösteren bir sürekli değişken",
     xlab=paste("basıklık=",skval,sep=""))
rug(noskew)
```

### Betimleyici İstatisklerin Raporlanması

_psych_ [@R-psych], _doBy_ [@R-doBy] ve _apaStyle_ [@R-apaStyle] paketleri betimsel analizleri rapor etmede yardımcı olabilir.

```{r, collapse=T, eval=T, cache=F, message=F}
# psych paketi describe fonksiyonu sırasıyla;
# n: gözlem sayısı (kayıp veriler hariç)
# ortalama, ss, ortanca, budanmış ortalama (trim=0.05 5% budanmış)
# ortanca mutlak dağılımı (median absolute deviation),
# minimum, maksimum, ranj
# çarpıklık ve basıklık-3 (type=2 popülasyon basıklık ve çarpıklık)
# standart hata 
library(psych)
desc1=describe(dataWBT[,c("gen_att","age")],trim = 0.05,type=3)
desc1

# kaydet
write.csv(desc1,file="pscyhbetimsel.csv")

#doBy
# program değişkenine göre betimleyici istatistikler
library(doBy)
library(moments)
desc2=as.matrix(summaryBy(gen_att+age~treatment, data = dataWBT, 
          FUN = function(x) { c(n = sum(!is.na(x)), nmis=sum(is.na(x)),
                                m = mean(x,na.rm=T), s = sd(x,na.rm=T),
                               skw=moments::skewness(x,na.rm=T),                    
                               krt=moments::kurtosis(x,na.rm=T)) } ))

#yuvarlama
round(desc2,2)
write.csv(round(desc2,2),file="doBydesc.csv")

#apaStyle
# APA formatında tablo
library(apaStyle)
apa.descriptives(data = dataWBT[,c("gen_att","age")], 
                 variables = c("Gender Attitude","Age"), report = c("M", "SD"), 
                 title = "APAtableGenderAge", filename = "APAtableGenderAge.docx", 
                 note = NULL, position = "lower", merge = FALSE, 
                 landscape = FALSE, save = TRUE)

#apaStyle paketi hata veriyorsa;
#https://www.r-statistics.com/2012/08/how-to-load-the-rjava-package-after-the-error-java_home-cannot-be-determined-from-the-registry/

#Sys.setenv(JAVA_HOME='C:\\Program Files\\Java\\jre1.8.0_111')
```


```{r apatable, fig.cap='APA Tablo.docx',echo=F, fig.width=8, fig.height=6}
knitr::include_graphics('apatable.png')
```



#### Betimsel İstatistik Rapor Örneği 
Toplumsal cinsiyet algısı puanları 5302 katılımcı için 1 ve 4 arasında değişmiştir, ortanca 2, ortalama 1.94 ve standart sapma 0.6 olarak hesaplanmıştır. Puanların dağılımı örneklem bazında 0.38 çarpıklık ve -0.1 basıklık değerine sahiptir.


##Basit Grafikler
R programı ile basit olmayan grafikler çizilebilir. Popüler olan grafik oluşturma yöntemlerinden dört tanesi, base[@R-base], lattice[@R-lattice], ggplot2[@R-ggplot2] ve plotrixtir[@R-plotrix]. Bu materyal ggplot2 kullanmıştır. Bir ggplot fonksiyonunda argüman sayısı oldukça fazladır, bu sayede kullanıcılar grafiğin her noktasında değişiklik yapabilirler.


### Histogram
Dikdörtgenlerden oluşan histogram grafikleri değişken içerisinde yer alan değerlerin frekanslarına göre oluşturulur.

#### Tek değişken için histogram 
Dağılım hakkında bilgi sahibi olmak için kullanışlıdır.

```{r genatthist, message=F,warning=F,fig.cap='Toplumsal Cinsiyet Algısı Puan Dağılımı'}
library(ggplot2)
ggplot(dataWBT, aes(x = gen_att)) +
  geom_histogram(binwidth = 0.2)+ theme_bw()+labs(x = "Toplumsal Cinsiyet Algısı ")+
  theme(axis.text=element_text(size=15),
        axis.title=element_text(size=14,face="bold"))

```

#### Tek değişken tek faktör histogram
Gruplara dayalı farklılıkları görmek için kullanışlı


```{r, message=F,warning=F, out.width='50%', fig.show='hold', fig.cap='Eğitime Göre Toplumsal Cinsiyet Algısı '}

dataWBT$HEF=droplevels(factor(dataWBT$higher_ed, 
                    levels = c(0,1), 
                    labels = c("Lise ve altı", "Üniversite")))

ggplot(dataWBT, aes(x = gen_att, fill=HEF,drop=T)) +
  geom_histogram(breaks=seq(1, 4, by =0.2),alpha=.5,col="black")+ 
  theme_bw()+labs(x = "Toplumsal Cinsiyet Algısı",fill='Yüksek Öğretim Durumu')+  
  theme(axis.text=element_text(size=15),
        axis.title=element_text(size=14,face="bold"))

dataWBT2=na.omit(dataWBT[,c("gen_att","HEF")])
ggplot(dataWBT2, aes(x = gen_att)) +
  geom_histogram(breaks=seq(1, 4, by =0.2),alpha=.5,col="black")+ 
  theme_bw()+labs(x = "Toplumsal Cinsiyet Algısı")+ facet_wrap(~ HEF)+
  theme(axis.text=element_text(size=15),
        axis.title=element_text(size=14,face="bold"))


```


```{r, message=F,warning=F}
library(ggplot2)
ggplot(dataWBT, aes(x = gen_att)) +
  geom_histogram(binwidth = 0.2)+ theme_bw()+
   facet_wrap(~city, ncol = 8)

```


#### Tek değişken iki faktör histogram

Useful for two way interactions
```{r, message=F,warning=F}
dataWBT2=na.omit(dataWBT[,c("gen_att","HEF","gender")])

ggplot(dataWBT2, aes(x = gen_att,fill=gender)) +labs(fill='Gender')+ 
  geom_histogram(binwidth = 0.2,alpha=.5)+ theme_bw()+
    facet_grid(~HEF)

```

#### Tek değişken üç faktör histogram

Etkileşim (interaction) açıklamada kullanışlı

```{r, message=F,warning=F}
dataWBT$Condition=droplevels(factor(dataWBT$treatment, 
                    levels = c(1,2), 
                    labels = c("treatment", "control")))

dataWBT2=na.omit(dataWBT[,c("gen_att","HEF","gender","Condition")])

ggplot(dataWBT2, aes(x = gen_att,fill=gender)) +labs(fill='Gender')+ 
  geom_histogram(binwidth = 0.2,alpha=.5)+ theme_bw()+
    facet_grid(~HEF+Condition)

```



## Hipotez Testi Tanıtım

Cambridge sözlüğü evren (popülasyon) tanımı olarak "aynı ülke, aynı alan veya aynı yerde yaşayan insan veya canlı grubu" cümlesini kullanır. Sosyal bilimlerde evren  genellikle "belli bir gruba ait bütün insanlar" olarak belirlenir. Örneğin _sekiz yaşındaki tüm öğrenciler_, _belli bir ülkede bulunan sekiz yaşındaki tüm öğrenciler_, _8 yaşında disleksi teşhisi konulan öğrenciler_.

Sosyal bilimciler araştırma soruları doğrultusunda ilgili evreni tanımlar. Evrende yer alan bireylerin (unit) gözlenlenebilen karakteristik özellikleri değişkenleri oluşturur. Diğer bir ifade ile değişkene ait popülasyon tanımlanabilir. Bölüm \@ref(variables) 'de   değişken türleri açıklanmıştır. Evren değişkene ait bütün değerleri kapsar, bu değerlere ait bir ranj ve görülme olasılığı (probability of occurence) vardır. Yoğunluk (probability, sürekli değişken için) ve çoğunluk (mass, sürekli olmayan değişken için) fonksiyonları görülme olasılıklarını formüle etmek için kullanışlıdır. Dağılım hakkında yapılacak geçerli bir varsayım ile örneklemden evrene genellemeler yapılabilir.

Seçkisiz seçilen bir örneklem ile ulaşılan değişken evrende sahip olduğu bütün değerleri içermeyebilir. Fakat, özellikle gözlem sayısı küçük değil ise, seçkisiz seçme işleminde sistematik bir yanlılık görülmeyeceği düşünüldüğünde, örneklemin evrene benzer özellikler göstermesi beklenir.Bu bilgi kullanılarak evrene ait bir parametre örneklemden yola çıkarak tahmin edilebilir. Bu işlem genellikle bir model sayesinde olur. Modelin veriye gösterdiği uyum araştırmacı tarafından değerlendirilir. Hipotez testleri kullanılan bir model sonrasında araştırma soruları ile ilgili  karara varma sürecidir.


### Örnekleme Dağılım {#samplingdist}

Seçkisiz bir örneklem için hesaplanmış bir istatistik aslında bir değişkendir ve belli bir dağılıma sahiptir. Örnekleme dağılım konusununu açıklamak için en çok kullanılan istatistik aritmetik ortalamadır. Merkezi limit teoremine göre basit seçkisiz örneklem kullanıldığında ^[evrende yer alan her üyenin eşit seçilme olasılığı olduğunda ve seçilen bir üyenin diğer bir üyenin seçilme olasılığını etkilemediği durumlarda] değişkenin evrende gösterdiği dağılımdan bağımsız olarak, o değişkene ait örneklem ortalamalarının dağılımı yaklaşık olarak normaldir. Örneklem büyüdükçe ; 

\begin{equation}
\bar X_n \sim N(\mu, \frac{\sigma^2}{n}).
(\#eq:CLTsem)
\end{equation}

Eğer evren bazında dağılım normal ise \@ref(eq:CLTsem) küçük örneklemler için de doğrudur.
Ortalamanın örnekleme dağılımına ait standart sapma _ortalamanın standart hatası_ olarak isimlendirilir ve istatistiksel çıkarımlarda kullanılır.
Eşitlik \@ref(eq:CLTsem) içinde yer alan  $\mu$ ve $\sigma^2$ bilinmezdir. Fakat bu eşitlik örnekleme ait ortalamanın evrene ait ortalamayı ne derecede kestirebileceğini anlamada önemlidir. Örneğin bir araştırmacının basit seçkisiz yöntemle 10 kişilik bir örneklem seçtiğini düşünelim. Araştırmacının bilemeceği parametrelerin ise $\mu=100$ ve $\sigma=15$ olduğunu düşünelim. Bu durumda örnekleme dağılım için standart sapma $(15⁄\sqrt{10})=4.74$ olarak bulunur. %95 olasılıkla araştımacının 10 kişilik örneklem ile ulaşacağı aritmetik ortalama 90.7 ve 109.3 arasında olacaktır. Bu oldukça geniş bir aralıktır. Fakat araştırmacı 10 kişi yerine 100 kişiyi aynı örneklem ile seçseydi ulaşacağı örneklem ortalaması %95 olasılıkla 97.1 ve 102.9 olacaktır. 

Bu noktada önem taşıyan konu, örneklemden gelen bilgilerle evrene ait parametrelerin hangi tahminleme yöntemleri (estimator) ile yansız, tutarlı ve keskin (unbiased, consistent and efficient) olarak kestirebileceğidir. Örneğin $\mu$, Eşitlik \@ref(eq:mean) ile,   $\sigma^2$ ise Eşitlik \@ref(eq:variance) ile yansız olarak kestirilebilir.

#### Yansız tahminleme ve örnneklem seçimi
Eklenecek 

### Güven Aralıkları (The Confidence Intervals (CI))
Dağılım hakkında yapılacak bir varsayım, örneklemden gelen bilgi ve uygun bir tahminleyici (estimator to produce a point estimate) kullanılarak güven aralıkları oluşturulabilir. Bir güven aralığı evren parametresinin muhtemelen hangi aralıkta olduğunu gösterir. Fakat bu evren parametresinin bu aralıkta kesinlikle yer aldığı anlamına gelmez.
Örnekleme ait aritmetik ortalamadan yola çıkarak evren parametresi için güven aralığı hesaplamak oldukça basittir.Değişkene ait dağılımın normal olduğu varsayıldığında, ortalamanın örnekleme dağılımı da normaldir ve örnekleme ait ortalama yansız bir tahmindir. Normal dağılım bilindik özellikleri vardır, yoğunluk fonksiyonu değerlerin %95'inin ortalamadan 1.96 standart sapma aşağıda ve yukarıda olduğunu gösterir. Normal dağılımın bu özelliği grafik   \@ref(fig:normaldist) ile gösterilmiştir. Mavi ile işaretlenen bölgeden bir gözlem yapma olasılığı %5tir. Benzer şekilde, mavi veya sarı ile işaretlenen bölgeden gözlem yapma olasılığı da %10'dur. Gri bölge ($\pm 1$) yoğunluğun yaklaşık olarak %68'ini kapsar.Bu bilgi kullanışlıdır. Örneklem için hesaplanan ortalama ve varyans $\mu$ için güven aralığı hesaplamada kullanılabilir.



```{r normaldist, message=F,warning=F,echo=FALSE,fig.cap='The z distribution'}
library(ggplot2)
df <- data.frame(z = seq(-4, 4, length = 500))

qplot(z, dnorm(z), data = df, geom = "area",fill=I("grey"), col=I("black")) + 
  scale_x_continuous(breaks = c(-4,-1.96,-1,0,1,1.96,4))+ 
  geom_text(aes(1.88, .11, label=", 1.65")) + geom_text(aes(-1.88, .11, label="-1.65 ,")) +
  geom_area(aes(group = sign(z)),data = subset(df, abs(z) > qnorm(1 - 0.05 / 2)), fill = "blue")+
  geom_area(aes(group = sign(z)), 
            data = subset(df, abs(z) < qnorm(1 - 0.05 / 2) & abs(z) > qnorm(1 - 0.1 / 2)), fill ="yellow")+
    geom_area(aes(group = sign(z)), 
            data = subset(df, abs(z) < qnorm(1 - 0.1 / 2) & abs(z) > 1), fill ="green")+theme_bw()
```




#### Güven Aralığı Örneği
Toplumsal Cinsiyet Algısına ait ortalama ve güven aralığı hesaplamaları

```{r, collapse=T, eval=T, cache=T,message=F}
# gözlem sayısı, n
GA_n=sum(!is.na(dataWBT$gen_att))

#ortalama
GA_m=mean(dataWBT$gen_att,na.rm = T)

#ss
GA_s=sd(dataWBT$gen_att,na.rm = T)

#95% güven aralığı
alt=GA_m - 1.96 * (GA_s/sqrt(GA_n))
alt
ust=GA_m + 1.96 * (GA_s/sqrt(GA_n))
ust

#veya 
GA_m +c(-1,1)*1.96 * (GA_s/sqrt(GA_n))


#1.96 için qnorm(0.975)

```

#### Ortalama için güven aralığı raporlama
5302 katılımcı için Toplumsal Cinsiyet Algısı puanlarına ait ortalama 1.94 (%95 GA [1.92-1.96]), standart sapma 0.60 bulunmuştur. 


### Yokluk Hipotezi 
Hipotez testinin amacı evren hakkında öne sürülen iki hipotezden hangisinin örneklem tarafından desteklendiğine karar vermektir. Bir hipotez testi beş basamaktan oluşur;

1) Yokluk hipotezinin^[Boş veya sıfır hipotezi olarak da bilinir] belirlenmesi (örneğin $\mu=0$)

2) Alternatif hipotezin belirlenmesi. (örneğin $\mu \neq 0$)

3) Test istatistiğinin seçilmesi

4) Test istatistiği ve belirlenen kritik değeri karşılaştırarak karar verilmesi. Eğer hesaplanan test istatistiği kritik değerden daha yüksekse yokluk hipotezinin ret edilmesi (kritik değer alternatif hipoteze göre değişir).

5) Sonucun açıklanması. Araştırma sorusuna yanıt vermek üzere kararın ifade edilmesi.

Yokluk hipotezi ($H_0$) ve alternatif hipotez ($H_1$) araştırma sorusunu cevaplamak üzere belirlenir. İstatistiksel kanıtlar yokluk hipotezini kabul veya terketmek için kullanılır. Yokluk hipotezini kabul etmek veya terketmek bir karardır, teorik istatistik açısından bu karara yönelik oluşabilecek durumlar şunlardır; 

| __Gerçekte Durum__ | __Karar__ |              __Sonuç__             |
|:-------------------:|:------------:|:-----------------------------------:|
|        $H_0$        |     Kabul $H_0$    |               Doğru Karar               |
|        $H_0$        |     Red $H_0$    | Yanlış Karar _(Tip I hata,$\alpha$)_ |
|        $H_1$        |    Red $H_0$    |               Doğru Karar               |
|        $H_1$        |    Kabul $H_0$    |     Yanlış Karar _(Tip II hata, $\beta$)_     |


Tip-I hata: Gerçekte doğru olduğu halde yokluk hipotezinin terkedilmesi durumudur. Alfa  , $\alpha$, yokluk hipotezinin gerçekte doğru olduğu halde red edilme olasılığıdır. Hipotez testi sürecinde önemli olan noktalardan biri $\alpha$'nın yeterince küçük olması gerektiğidir. Sosyal bilimlerde sıklıkla $\alpha=.05$ kullanılır.  

Tip-II hata: Gerçekte yanlış olan bir yokluk hipotezinin terkedilememisidir.  Beta, $\beta$, gerçekte yanlış olan bir yokluk hipotezini kabul etme olasılığıdır.


### z-puanı ve z-testi
z-puanı için genel formül;
$$z_X=\frac{X-\bar{X}}{s_X}$$

Hesaplanan bu z değişkeni 0 ortalamaya ve 1 standart sapmaya sahiptir. Eğer X normal dağılım gösteriyorsa z de normal dağılım gösterir.


```{r, collapse=T}
# z puanı hesapla

GA_m=mean(dataWBT$gen_att,na.rm = T)
GA_s=sd(dataWBT$gen_att,na.rm = T)
z_GA=(dataWBT$gen_att-GA_m)/GA_s

#veya
z_GA=scale(dataWBT$gen_att, center=T, scale=T)

# scale fonksiyonu ile birden fazla değisken için z hesaplanabilir.
# center=T her X puanından ortalamayı çıkarır
# scale=T farkı standart sapmaya böler
# scale(dataWBT$gen_att, center=3, scale=2)her değerden 3 çıkarıp 2'ye böler.

```

Ortalama için z-istatistiği hesaplamak kolaydır;

$$ z=\frac{\bar{X}-\mu_{hipotez}}{Standart Hata} = \frac{\bar{X}-\mu_{hipotez}}{\sigma_X/\sqrt{n}}$$
Hesaplanan bu z istatistiği bir z dağılımı kullanılarak yorumlanabilir (Figure \@ref(fig:normaldist)); 

a) Eğer alternatif hipotez, gözlemlenen ortalamanın, hipotez değerinden küçük olacağını belirtiyorsa, hesaplanan z istatistiği $z_{alpha}$ veya $-z_{(1-alpha)}$ ile kıyaslanır. Eğer hesaplanan z ,  $z_{alpha}$'ya eşit veya küçük ise yokluk hipotezi terkedilir.

b) Eğer alternatif hipotez, gözlemlenen ortalamanın, hipotez değerinden farklı olacağını belirtiyorsa, hesaplanan z istatistiğinin mutlak değeri $z_{1-(alpha/2)}$ ile kıyaslanır. Eğer mutlak z ,  $z_{1-(alpha/2)}$'ya eşit veya büyük ise yokluk hipotezi terkedilir.


c) Eğer alternatif hipotez, gözlemlenen ortalamanın, hipotez değerinden büyük olacağını belirtiyorsa, hesaplanan z istatistiği $z_{1-alpha}$ ile kıyaslanır. Eğer hesaplanan z ,  $z_{1-(alpha)}$'ya eşit veya büyük ise yokluk hipotezi terkedilir.
 
Burada dikkat edilmesi gereken nokta a ve c senaryolarında (yönlü alternatif)  kullanılan kritik değerin b senaryosunda (yönsüz alternatif) kullanılan kritik değerden farklı oluşudur. Araştırmacılar alternatif hipotezlerinin yönlü veya yönsüz oluşunu savunabilmelidir.


#### z test illustration-1 (non-directional)
Stating the null as $H_0: \mu_{Gender Attitudes} = 2$ and alternative as $H_1: \mu_{Gender Attitudes} \neq 2$ and using  $\alpha=0.05$;

```{r, collapse=T, eval=T, cache=T,message=F}
# the number of available data points, n
GA_n=sum(!is.na(dataWBT$gen_att))

#calculate the mean
GA_m=mean(dataWBT$gen_att,na.rm = T)

#calculate the sd
GA_s=sd(dataWBT$gen_att,na.rm = T)

# set the null
mu_hyp=2

# z statistic
(GA_m-mu_hyp)/(GA_s/sqrt(GA_n))

#the critical value for alpha=0.05 and nondirectional test 
qnorm(1-(0.05/2))


```

The Gender Attitudes score from 5302 participants had a mean of 1.94 and SD=0.6. A one-sample z test revealed that the observed mean is 7.17 standard deviation below the hypothesized mean of 2. Using a rejection criteria of 1.96 ($z_{1-(0.05/2)}$) the difference between the observed mean and the hypothesized mean was concluded to be statistically significant.


#### z test illustration-2 (directional)
In this illustration, the Gender Attitudes scores' population mean is assumed to be 1.9 with a standard deviation of 0.75. When the population standard deviation is known it should be used. Stating the null as $H_0: \mu_{Gender Attitudes} = 1.9$ and alternative as $H_1: \mu_{Gender Attitudes} > 1.9$ and using  $\alpha=0.01$;

```{r, collapse=T, eval=T, cache=T,message=F}
# set the null
mu_hyp=1.9

# z statistic
(GA_m-mu_hyp)/(0.75/sqrt(GA_n))

#the critical value for alpha=0.01 and directional test 
qnorm(1-(0.01))

```

Using a critical value of 2.33 ($z_{0.99}$), results indicated that the Gender Attitudes scores' mean was significantly greater than the hypothesized value of 1.9 ($z=3.94$).

### The one-sample t test

Interpreting a z statistic based on a z distribution is not valid for small sample sizes. If the sample size is small, a t distribution with a n-1 degrees of freedom is valid assuming the population has a normal distribution. The procedure is the same as the z-statistic, but the critical values change.



#### t test illustration-1 (non-directional)
In the dataWBT, city _DUZCE_ has only 52 participants and 47 available Gender Attitudes scores. For illustrative purposes this city is chosen.

Stating the null as $H_0: \mu_{Gender Attitudes} = 1.94$ and alternative as $H_1: \mu_{Gender Attitudes} \neq 1.94$ and using  $\alpha=0.05$;

```{r, collapse=T, eval=T, cache=F,message=F}
dataWBT_DUZCE=dataWBT[dataWBT$city=="DUZCE",]
#descriptive statistics
describe(dataWBT_DUZCE[,"gen_att"],type=3)

#t test
t.test(dataWBT_DUZCE$gen_att,
       alternative="two.sided",
       mu=1.94,
       conf.level = 0.95)

#critical value
qt(.975,df=46)
```

The Gender Attitudes scores from 47 participants in DUZCE had a range of 1–3.8, a median of 2, a mean of 2.18 and SD=0.55. The score distribution had a sample skewness value of 0.56 and a sample kurtosis value of 0.28.^[Descriptive statistics were calculated with _psych_ [@R-psych] package.] A one sample t-test revealed a significant difference, t(46)=2.94 between the city's observed mean and the hypothesized mean of 1.94 using a critical value of 2.01 ($t_{.975,46}$).

#### t test illustration-2 
In the previous example a directional test was conducted in which the alternative hypothesis specified that the population mean would not be equal to 1.94.  What will happen if the null hypothesis  is $H_1:\mu_{GenderAttitudes} \leq 1.94$?

For the city _DUZCE_, stating the null as $H_0: \mu_{Gender Attitudes} = 1.94$ and alternative as $H_1: \mu_{Gender Attitudes} \leq 1.94$ and using  $\alpha=0.05$;

```{r, collapse=T, eval=T, cache=F,message=F}
#t test
t.test(dataWBT_DUZCE$gen_att,
       alternative="less",
       mu=1.94,
       conf.level = 0.95)

#critical value
qt(.05,df=46)
```

A one sample t-test, t(46)=2.94, revealed that the evidence does not support a conclusion that the population mean is smaller than 1.94, using a critical value of -1.68 ($t_{.05,46}$).

### The p value

The t-test illustrations (the t.test function) reported a p-value. Calculation of a p-value is based on the assumption that the null hypothesis is true and an assumption about the distribution of the test statistic . The p-value aims to inform if the calculated statistic is ordinary or not for a given distribution.  Historically, a p-value smaller than the pre-determined alpha value led researchers to conclude whether a finding is statistically significant.


### The p value illustration
Assuming a z-distribution is valid, and the calculated z-statistic is 1.80, following visual is drawn.

```{r pvalue1, message=F,warning=F,echo=FALSE,fig.cap='The z distribution and z=1.8'}
library(ggplot2)
df <- data.frame(z = seq(-4, 4, length = 500))

qplot(z, dnorm(z), data = df, geom = "area",fill=I("grey"), col=I("black")) + 
  scale_x_continuous(breaks = c(-4,0,1.8,4))+ geom_vline(xintercept = 1.8)+
  geom_area(aes(group = sign(z)),data = subset(df, z > 1.8), fill = "blue")+theme_bw()
```

The blue area corresponds to 3.6% of the density, in other words p=0.0359;
```{r}
1-pnorm(1.8)
```

This p-value is valid for a directional test but not for a non-directional test. When the uncertainty exists for the direction, the following visual depicts the situation;

```{r pvalue2, message=F,warning=F,echo=FALSE,fig.cap='The z distribution and abs(z)=1.8'}
library(ggplot2)
df <- data.frame(z = seq(-4, 4, length = 500))

qplot(z, dnorm(z), data = df, geom = "area",fill=I("grey"), col=I("black")) + 
  scale_x_continuous(breaks = c(-4,-1.8,0,1.8,4))+ geom_vline(xintercept = c(-1.8,1.8))+
  geom_area(aes(group = sign(z)),data = subset(df, abs(z) > 1.8), fill = "blue")+theme_bw()
```

The blue area, now, corresponds to 7.2% of the density, in other words p=0.0719;
```{r}
2*(1-pnorm(1.8))
```

### Statistical power {#statisticalpower}

The power of a statistical test is the probability that it will correctly reject the null hypothesis,and is equal to $1-\beta$. This probability can be computed a-priori or post-hoc, whereas a post-hoc analysis is less useful. A-priori power analyses is helpful to design a study and to decide the desired sample size. A-priori power analyses are required for the related grant proposals.

The plot produce by the following R program can be used to explain statistical power^[partially based on http://multithreaded.stitchfix.com/blog/2015/05/26/significant-sample/]. 

```{r zpower, message=F,warning=F,echo=T,fig.cap='Power illustration with z distribution'}
x <- seq(-4, 8, 0.02)
zdat <- data.frame(x = x, y1 = dnorm(x, 0, 1), y2 = dnorm(x, 2.5, 1))
ggplot(zdat, aes(x = x)) +
  geom_line(aes(y = y1), size=2) +
  geom_line(aes(y = y2), color='red',size=2) +
  geom_vline(xintercept = c(0,2.5), color="black", linetype = "longdash")+
  geom_vline(xintercept = qnorm(1 - 0.05))+
  scale_x_continuous(breaks = c(-4,0,1.65,2.5,4))+
  annotate("text", label="beta" , x=1.1, y=0.05, parse=T, fontface =2, size=6)+
  annotate("text", label="alpha", x=2  , y=0.02, parse=T, fontface =2, size=6)+
  annotate("text", label="1-~beta", x=3.3, y=0.1, parse=T, fontface =2,size=6)+
  geom_area(aes(y=y1, x = ifelse(x > qnorm(.95), x, NA)), fill = 'blue'  , alpha=0.25) +
  geom_area(aes(y=y2, x = ifelse(x > qnorm(.95), x, NA)), fill = 'green' , alpha=0.25) +
  geom_area(aes(y=y2, x = ifelse(x < qnorm(.95), x, NA)), fill = 'yellow', alpha=0.25) +
  xlab("z") + ylab("dnorm(z)") + theme_bw()
```

The  z distribution assuming a true null hypothesis ($H_0:\mu=0$) is depicted with black borders; the mean for the sampling distribution is 0 under this assumption and is shown with a dashed line. The z distribution assuming (a) the null hypothesis is false and (b) the actual population mean and standard deviation are such that $((\mu-\mu_{hypothesis} )⁄(\sigma⁄\sqrt{n})=2.5)$ is depicted with red borders. This visual is valid for a directional test with $\alpha=0.05$, hence, with a critical value of $z_{0.95}=1.65$. The blue area represents $\alpha$, the yellow area represent $\beta$ and the green area represents power. In this particular case the power is .804. 
```{r}
1-pnorm(qnorm(0.95),mean=2.5)
```




Figure \@ref(fig:zpower) visually shows that^[accurate only for post hoc power] a power calculation includes 2 distributions, an alpha value and a test statistic. With these knowns the statistical power can be calculated. It should be noted that a test statistic has its own elements, generally a numerator and a denominator. For a z test, the numerator is the difference between the hypothesized mean and the null, whereas the denominator is the standard error of the mean ($\sigma/\sqrt(n)$). If the power is set to a constant (i.e. .80) , equation can be solved for any desired unknown. Generally, the equation is solved for _n_, the sample size. 

The statistical power is revisited in the following chapters. Each design has its own standard error of the parameter estimate and the test statistic has its own distributional features. For a one sample t-test, the  _power.t.test_ function is useful;

```{r, collapse=T, eval=T, cache=F,message=F}
#power.t.test
power.t.test(delta=.1, sd=.6,sig.level=0.05, power=0.9, 
             type="one.sample", alternative="one.sided")

```

This illustration shows that for pre-determined knowns of a mean difference of 0.1, a standard deviation of 0.6, an alpha level of 0.05, a directional test and a desired power of 0.9, the sample size should be 310. In other words, the probability of rejecting the null ($H_0:\mu=0$) is .9 with a sample size of 310, a mean difference of 0.1, SD=0.6, alpha=0.05 and a directional test.

### In case the z and the t distribution is not valid
Generalization from knowns to unknowns requires assumptions. A test statistic is robust to a violation of an assumption if, for a given sample size, the sampling distribution of the test statistic remains substantially the same under violation of the assumption(@verzani2014). It should be noted that a test statistic may be robust to violations of one assumption but not to violation of another assumption. In addition a test statistic that is robust to violation of one assumption, may not be robust to violation of that assumption when a second assumption is also violated. Even when a test statistic is robust to violation of assumptions, there may be a better test statistic to use when those assumptions are violated.

The z statistic for the one sample mean is expected to be robust against the violations of normality when the sample size is larger than 30 (@Andy2012, page 198).  However, it should be noted that the rate at which the sampling distribution converges to normality depends on the distribution of the data. As a separate note, if the population is assumed to be normal and the sample sizes small, a t distribution is valid.

There are several approaches to produce robust statistics for a one-sample mean test, comprehensively illustrated by @wilcox2012. Below R code calculates 95% confidence intervals using the second variation of the bootstrap-t method (@wilcox2012, page 117)

```{r, collapse=T, eval=T, cache=F,message=F}
#the second variation of the bootstrap-t method
# select DUZCE and perfom listwise deletion using na.omit
dataWBT_DUZCE=na.omit(dataWBT[dataWBT$city=="DUZCE",c("id","gen_att")])

# test whether the Gender Attitudes' mean is equal to 1.94
# assuming normality and using a t-test
t.test(dataWBT_DUZCE$gen_att,mu=1.94,conf.level = 0.95)


#Calculate 95% CI using bootstrap (normality is not assumed)
set.seed(04012017)
B=5000       # number of bootstraps
alpha=0.05   # alpha

#x is the variable
# xBAR is the observed mean
tstar=function(x,xBAR) sqrt(length(x))*abs(mean(x)-xBAR)/sd(x)


output=c()
for (i in 1:B){
  output[i]=tstar(sample(dataWBT_DUZCE$gen_att,
                         replace=T,
                         size=length(dataWBT_DUZCE$gen_att)),
                  xBAR=mean(dataWBT_DUZCE$gen_att))
  }
output=sort(output)
Tc=output[as.integer(B*(1-alpha))]

#bootstrap confidence interval
mean(dataWBT_DUZCE$gen_att)+c(-1,1)*(Tc*sd(dataWBT_DUZCE$gen_att)/sqrt(length(dataWBT_DUZCE$gen_att)))

```

#### Write up 
The Gender Attitudes scores from 47 participants in DUZCE had a range of 1 to 3.8, a median of 2, a mean of 2.18 and SD=0.55. The score distribution had a sample skewness value of 0.56 and a sample kurtosis value of 0.28. Using a critical value of 2.01 ($t_{.975,46}$), a one sample t-test revealed a significant difference, t(46)=2.94 between the city's observed mean and the hypothesized mean of 1.94 . When the normality is assumed, the 95% confidence intervals using a t-distribution were [2.01,2.34]. When this assumption is not made, the 95% confidence intervals using the bootstrap-t method with 5000 replications [@wilcox2012] were [2.01,2.34]. 


### Shiny application to visualize sampling distribution
To be added.
